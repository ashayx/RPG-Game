var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,a){function o(t){try{h(r.next(t))}catch(e){a(e)}}function s(t){try{h(r["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,s)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],a=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameTimeData=function(){function t(){this._costT=0,this.day=0,this.hour=0,this.min=0,this.pd="",this.isLight=!1}return t.prototype.play=function(){this.synGameTime(),RenderManager.getIns().registRender(this)},t.prototype.synGameTime=function(){this.min=GameData.playerData.time%60,this.hour=Math.trunc(GameData.playerData.time/60)%24,this.day=Math.trunc(GameData.playerData.time/1440),this.day+=1,this.pd=this.hour<12?t.AM:t.PM,this.isLight=this.hour>=20||this.hour<6},t.prototype.renderUpdate=function(t){this._costT+=t,this._costT>=GameConfig.game_time_t_my&&(this._costT=this._costT-GameConfig.game_time_t_my,GameData.playerData.time+=1,this.synGameTime())},t.PM="PM",t.AM="AM",t}();__reflect(GameTimeData.prototype,"GameTimeData",["IRender"]);var ModuleBase=function(){function t(t){this.moduleID=0,this.moduleID=t,this.__reqHandlerMap=new Map}return t.prototype.requestToServer=function(e,i){i=this.__reqHandlerMap.get(e).apply(this,[t.TYPE_RQ,i]),ServerVirtual.request(this.moduleID,e,i)},t.prototype.responseFromServer=function(e,i){this.__reqHandlerMap.get(e).apply(this,[t.TYPE_RS,i])},t.prototype.registHandler=function(t,e){this.__reqHandlerMap.set(t,e)},t.TYPE_RQ=1,t.TYPE_RS=2,t}();__reflect(ModuleBase.prototype,"ModuleBase");var WindowType=function(){function t(){}return t.ALERT_WIN="ALERT_WIN",t}();__reflect(WindowType.prototype,"WindowType");var GameWindow=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layerType="",e.__inited=!1,e.__align="NONE",e.__offsetX=0,e.__offsetY=0,e.pop=!1,e}return __extends(e,t),e.prototype.partAdded=function(e,i){i.name=e,t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.visible=!0,this.resize()},e.prototype.reOpen=function(){this.visible=!0},e.prototype.update=function(t,e){},e.prototype.beforeClose=function(){return!0},e.prototype.resize=function(){switch(this.__align){case AlignType.TOP_LEFT:this.x=this.__offsetX,this.y=this.__offsetY;break;case AlignType.TOP_CENTER:this.x=(App.UIAdapter.StageWidth-this.width*this.scaleX)/2+this.__offsetX,this.y=this.__offsetY;break;case AlignType.TOP_RIGHT:this.x=App.UIAdapter.StageWidth-this.width*this.scaleX+this.__offsetX,this.y=this.__offsetY;break;case AlignType.CENTER:this.x=(App.UIAdapter.StageWidth-this.width*this.scaleX)/2+this.__offsetX,this.y=(App.UIAdapter.StageHeight-this.height*this.scaleY)/2+this.__offsetY;break;case AlignType.BOTTOM_LEFT:this.x=this.__offsetX,this.y=App.UIAdapter.StageHeight-this.height*this.scaleY+this.__offsetY;break;case AlignType.BOTTOM_CENTER:this.x=this.x=(App.UIAdapter.StageWidth-this.width*this.scaleX)/2+this.__offsetX,this.y=App.UIAdapter.StageHeight-this.height*this.scaleY+this.__offsetY;break;case AlignType.BOTTOM_RIGHT:this.x=App.UIAdapter.StageWidth-this.width*this.scaleX+this.__offsetX,this.y=App.UIAdapter.StageHeight-this.height*this.scaleY+this.__offsetY}},e.prototype.align=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.__align=t,this.__offsetX=e*this.scaleX,this.__offsetY=i*this.scaleY,null!=this.stage&&this.resize()},e.prototype.addEventTap=function(t){switch(typeof t){case"string":this.getChildByName(t).addEventListener(egret.TouchEvent.TOUCH_TAP,this.eventTapHandler,this);break;case"object":var e;for(e in t)this.getChildByName(t[e]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.eventTapHandler,this);break;default:throw new Error(NodepErrorType.PARAM_TYPE_ERROR)}},e.prototype.tapCallback=function(t){},e.prototype.eventTapHandler=function(t){this.tapCallback(t.currentTarget.name)},e}(eui.Component);__reflect(GameWindow.prototype,"GameWindow");var FocusRole=function(t){function e(){var i=t.call(this)||this;return i.__isFocus=!1,i.id=0,e._addId++,i.id=e._addId,i}return __extends(e,t),e.prototype.renderUpdate=function(t){},e.prototype.addToWorld=function(){RenderManager.getIns().registRender(this)},e.prototype.setFocus=function(t){return this.__isFocus=t,this},e.prototype.checkPosY=function(){for(;this._preLink&&this.y<this._preLink.y;)StageLayer.self.gotoPre(this);for(;this._nextLink&&this.y>this._nextLink.y;)StageLayer.self.gotoNext(this)},e.prototype.getPre=function(){return this._preLink},e.prototype.setPre=function(t){this._preLink=t},e.prototype.getNext=function(){return this._nextLink},e.prototype.setNext=function(t){this._nextLink=t},e.prototype.setAreaKey=function(t){this._ak=t},e.prototype.getAreaKey=function(){return this._ak},e.prototype.removed=function(){},e.prototype.added=function(){},e.prototype.tryOption=function(t,e){return 0},e.prototype.hitTestArea=function(t,e){return!1},e.prototype.getOptType=function(){return this.type},e._addId=0,e}(egret.DisplayObjectContainer);__reflect(FocusRole.prototype,"FocusRole",["IFocus","IRender","ILink","IRole"]);var EquipData=function(){function t(){this.posMap=new Map}return t}();__reflect(EquipData.prototype,"EquipData");var BaseComponent=function(t){function e(){var e=t.call(this)||this;return e.isCreate=!1,e.waitTime=0,egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE,e.onUIChange,e),e.width=App.UIAdapter.MainShowWidth,e.height=App.UIAdapter.MainShowHeight,e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isCreate=!0,this.initData(),this.initUI(),this.initListener()},e.prototype.adapComponent=function(t,e){this.componentArr||(this.componentArr=[]),this.componentArr[e]||(this.componentArr[e]=[]);var i=this.componentArr[e].indexOf(t);-1==i&&this.componentArr[e].push(t),App.UIAdapter.adaptiveComponent(t,e)},e.prototype.onUIChange=function(){var t=this;this.width=App.UIAdapter.MainShowWidth,this.height=App.UIAdapter.MainShowHeight,log(this.componentArr,this.width,this.height),this.componentArr&&this.componentArr.forEach(function(e,i){e.forEach(function(e,r){t.adapComponent(e,i)},t)},this)},e.prototype.initData=function(){this.addEventBtnArr=[],this.effectArr=[]},e.prototype.initUI=function(){},e.prototype.initListener=function(){},e.prototype.removeListener=function(){for(egret.MainContext.instance.stage.removeEventListener(egret.Event.RESIZE,this.onUIChange,this);this.addEventBtnArr&&this.addEventBtnArr.length>0;){var t=this.addEventBtnArr.shift();t&&this.removeBtnClick(t)}},e.prototype.addBtnClick=function(t,e){if(void 0===e&&(e=!1),t&&-1==this.addEventBtnArr.indexOf(t)&&(t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.addEventBtnArr.push(t),e)){this.effectArr.push(t.hashCode),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnEffect,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnEffect,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBtnEffect,this);var i=t.width,r=t.height,n=i>>1,a=r>>1;t.x+=n-t.anchorOffsetX,t.y+=a-t.anchorOffsetY,t.anchorOffsetX=n,t.anchorOffsetY=a}},e.prototype.removeBtnClick=function(t){if(t){var e=this.addEventBtnArr.indexOf(t);-1!=e&&(t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.addEventBtnArr.splice(e,1)),e=this.effectArr.indexOf(t.hashCode),-1!=e&&(egret.Tween.removeTweens(t),t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnEffect,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnEffect,this),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBtnEffect,this),this.effectArr.splice(e,1))}},e.prototype.onClick=function(t,e){void 0===e&&(e=this.waitTime);var i=t.currentTarget;e>0&&(i.touchEnabled=!1)},e.prototype.onBtnEffect=function(t){var e=t.currentTarget;egret.Tween.removeTweens(e),t.type==egret.TouchEvent.TOUCH_BEGIN?egret.Tween.get(e).to({scaleX:.8,scaleY:.8},200,egret.Ease.quadOut):(t.type==egret.TouchEvent.TOUCH_END||t.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE)&&egret.Tween.get(e).to({scaleX:1,scaleY:1},300,egret.Ease.backOut)},e.prototype.updateView=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destroy=function(){this.removeListener(),this.componentArr=null,this.effectArr=null},e.prototype.close=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(BaseComponent.prototype,"BaseComponent",["eui.UIComponent","egret.DisplayObject"]);var HistoryData=function(){function t(){this.hasData=!1,this.has=0}return t.prototype.initHistoryData=function(t){this.hasData=1==t.has},t}();__reflect(HistoryData.prototype,"HistoryData");var ItemData=function(){function t(){this.materials=[],this.bookss=[],this.tasks=[],this.rubbishs=[]}return t}();__reflect(ItemData.prototype,"ItemData");var LloydMapData=function(){function t(){this._altitude=0,this._areaDic=new Map,this._polDic=new Map,this._points=new Map,this._areas=new Array,this._lakes=new Array,this._rivers=new Array,this._gridDicW=30,t._fixLen=t._fixFloorTypes.length,t._fixFloorTypes.sort(function(t,e){return t>e?1:-1})}return t.prototype.buildGridDic=function(t,e){this._gridDic=new Map;for(var i=Math.floor(t/this._gridDicW)+1,r=Math.floor(e/this._gridDicW)+1,n=0;i>n;n++)for(var a=0;r>a;a++)this._gridDic.set(n+"_"+a,new Array)},t.prototype.initGridDic=function(){var t,e;for(t in this._areas){e=this._areas[t];var i=Math.floor(e.centerPoint.x/this._gridDicW),r=Math.floor(e.centerPoint.y/this._gridDicW);this._gridDic.get(i+"_"+r).push(e)}},t.prototype.getFloorTypeByArea=function(t,e){for(var i,r,n,a=Math.floor(t/this._gridDicW),o=Math.floor(e/this._gridDicW),s=1e6,h=0,p=a-1;a+1>=p;p++)for(var l=o-1;o+1>=l;l++)if(i=this._gridDic.get(p+"_"+l),null!=i)for(r in i){n=i[r];var c=TriangleUtil.distance(t-n.centerPoint.x,e-n.centerPoint.y);s>c&&(s=c,h=n.type)}return h},t.prototype.getFloorType=function(e,i){var r;if(GameConfig.showRiver&&(r=this.riverMap.getPixel32(e,i),r[3]>=10))return t.LAKE;r=this.baseMap.getPixel32(e,i);var n=r[0]<<16|r[1]<<8|r[2];return t._fixFloorTypes.indexOf(n)<0?-n:n},t.prototype.getFloorTypeByPx=function(t,e){return t=Math.floor(t/GameConfig.map_cfx),e=this.baseMap.$bitmapHeight-Math.floor(e/GameConfig.map_cfy),this.getFloorType(t,e)},t.prototype.build=function(t){this.sizeX=t.w,this.sizeY=t.h,this.buildGridDic(this.sizeX,this.sizeY);for(var e,i,r=new Map;t.p2d.length>0;)e=t.p2d.pop(),i=new AreaPoint,i.id=e.id,i.x=e.x,i.y=e.y,i.river=e.r,r.set(i.id,i);for(var n,a,o=new Array;t.areas.length>0;)for(n=new Area2D,a=t.areas.pop(),o.push(a),n.id=a.id,n.centerPoint=new egret.Point(a.cp.x,a.cp.y),n.type=a.ty,this._areaDic.set(n.id,n),this._areas.push(n);a.vers.length>0;)n.vertex.push(r.get(a.vers.pop()));for(;o.length>0;)for(a=o.pop(),n=this._areaDic.get(a.id);a.nears.length>0;)n.neighbor.push(this._areaDic.get(a.nears.pop()));for(var s,h;t.river.length>0;)for(s=t.river.pop(),h=new River,this._rivers.push(h),h.startArea=this._areaDic.get(s.id);s.ps.length>0;)h.downsteams.push(r.get(s.ps.shift()));this.initGridDic()},t.prototype.getDb=function(){var t=new Object;t.w=this.sizeX,t.h=this.sizeY,t.areas=new Array,t.p2d=new Array,t.river=new Array;var e,i,r,n=[];for(e in this._areas){r=this._areas[e];var a=new Object;t.areas.push(a),a.id=r.id,a.cp=r.centerPoint,a.ty=r.type,a.nears=new Array;for(e in r.neighbor)a.nears.push(r.neighbor[e].id);a.vers=new Array;for(e in r.vertex)a.vers.push(r.vertex[e].id);for(e in r.vertex)if(i=r.vertex[e],!(n.indexOf(i.id)>=0)){n.push(i.id);var o=new Object;o.id=i.id,o.x=i.x,o.y=i.y,o.r=i.river,t.p2d.push(o)}}var s;for(e in this._rivers){s=this._rivers[e];var h=new Object;h.id=s.startArea.id,h.ps=new Array;for(e in s.downsteams)i=s.downsteams[e],h.ps.push(i.id);t.river.push(h)}return t},t.prototype.initData=function(t,e,i){this.buildGridDic(e,i),this.sizeX=e,this.sizeY=i,this._altitude=0;var r,n;for(r in t){n=t[r];var a=new Area2D;a.id=n.centerPoint.id,this._areaDic.set(a.id,a),this._polDic.set(a.id,n),a.centerPoint=new egret.Point(n.centerPoint.x,n.centerPoint.y),a.isOutside=n.isos;var o;for(r in n.vertex){o=n.vertex[r],null==this._points.get(o.id)&&this._points.set(o.id,new AreaPoint(o.x,o.y));var s=this._points.get(o.id);s.id=o.id,a.vertex.push(s),s.areas.indexOf(a.id)<0&&s.areas.push(a.id)}this._areas.push(a)}},t.prototype.adjustCoast=function(e,i){var r,n,a=0,o=0,s=i.length/this.sizeX,h=i[0].length/this.sizeY;for(n in this._areas){r=this._areas[n];var p=Math.floor(r.centerPoint.x*s),l=Math.floor(r.centerPoint.y*h),c=i[p][l];c+=this._altitude,a++,127.5>c&&!r.isOutside?(r.type=t.LAND,r.isWater=!1,o++):(r.type=t.SEA,r.isWater=!0)}e>o/a&&(this._altitude-=5.1,this.adjustCoast(e,i))},t.prototype.initArea=function(){var t,e,i,r,n,a=[];for(t in this._areas){e=this._areas[t];var o=this._polDic.get(e.id),s=[];for(t in o.centerPoint.tris){i=o.centerPoint.tris[t];for(t in i.vertex)r=i.vertex[t],r.id!=e.id&&s.indexOf(r.id)<0&&null!=this._areaDic.get(r.id)&&(s.push(r.id),e.neighbor.push(this._areaDic.get(r.id)))}for(t in e.vertex)if(n=e.vertex[t],!(a.indexOf(n.id)>=0)){a.push(n.id);var h=o.getPointByID(n.id);n.nears.indexOf(this._points.get(o.getNextPoint(h).id))<0&&n.nears.push(this._points.get(o.getNextPoint(h).id)),n.nears.indexOf(this._points.get(o.getPrePoint(h).id))<0&&n.nears.push(this._points.get(o.getPrePoint(h).id));var p;for(t in e.neighbor){p=e.neighbor[t];var l=this._polDic.get(p.id),c=l.getNextPoint(h);null!=c&&n.nears.indexOf(this._points.get(c.id))<0&&n.nears.push(this._points.get(c.id)),c=l.getPrePoint(h),null!=c&&n.nears.indexOf(this._points.get(c.id))<0&&n.nears.push(this._points.get(c.id))}}}},t.prototype.checkTerrain=function(){var e,i,r,n=new Array;for(i in this._areas)r=this._areas[i],r.isWater&&(null==e&&r.isOutside?e=r:n.push(r));for(var a,o=e.neighbor,s=o.length;s>0;){a=new Array,s=0;for(i in o){r=o[i];var h=n.indexOf(r);if(h>=0){n.splice(h,1),s++;var p;for(p in r.neighbor){var l=r.neighbor[p];n.indexOf(l)>=0&&a.push(l)}}}o=a}for(i in n)r=n[i],r.type=t.LAKE;for(;n.length>0;){var c=this.findLake(n);c.checkSefl(),this._lakes.push(c)}},t.prototype.amendLake=function(e,i){if(!(this._lakes.length>=e&&this._lakes.length<=i)){for(var r,n,a,o=0;this._lakes.length>i;)for(r=this._lakes[0],this._lakes.splice(0,1),n=r.getAreas(),o;o<n.length;o++)a=this._areaDic.get(n[o]),a.type=t.LAND,a.isWater=!1;for(var s=e+Math.round(Math.random()*(i-e));this._lakes.length<s;)this.createRandomLake()}},t.prototype.createRandomLake=function(){var e,i,r;for(e in this._areas)if(i=this._areas[e],this.isInLand(i))break;var n=1,a=new Array;a.push(i);for(var o,s=i.neighbor,h=Math.floor(2+3*Math.random());a.length<h;){o=new Array;for(e in s)if(r=s[e],a.indexOf(r)<0&&a.length<h&&this.isInLand(r)){a.push(r);for(var p=0;p<r.neighbor.length;p++)o.push(r.neighbor[p])}if(s=o,a.length==n)break;n=a.length}var l=new Lake;for(e in a)r=a[e],r.type=t.LAKE,r.isWater=!0,l.addArea(r.id);this._lakes.push(l)},t.prototype.isInLand=function(t){if(t.isWater)return!1;var e;e=t.neighbor;var i,r=!0;for(i in e)if(t=e[i],t.isWater){r=!1;break}return r},t.prototype.isInWater=function(t){if(!t.isWater)return!1;var e;e=t.neighbor;var i,r=!0;for(i in e)if(t=e[i],!t.isWater){r=!1;break}return r},t.prototype.findLake=function(t){var e=new Lake,i=t[0];e.addArea(i.id),t.splice(0,1);for(var r,n,a,o=i.neighbor,s=o.length;s>0;){a=new Array,s=0;for(r in o){n=o[r];var h=t.indexOf(n);if(h>=0){e.addArea(n.id),t.splice(h,1),s++;var p;for(p in n.neighbor){var l=n.neighbor[p];t.indexOf(l)>=0&&a.push(l)}}}o=a}return e},t.prototype.getAllInLand=function(e,i,r){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===r&&(r=0);var n,a,o=new Array;if(e)for(n in this._areas){a=this._areas[n];for(n in a.vertex)a.vertex[n].elevation=-99999,a.isWater&&(a.vertex[n].river=1)}for(n in this._areas){if(a=this._areas[n],e){var s=-1e5;if(a.isWater&&a.type!=t.LAKE)for(n in a.vertex)a.vertex[n].elevation=s}this.isInLand(a)&&(0==r||a.getElevation()>=i&&a.getElevation()<=r)&&o.push(a)}return o},t.prototype.initAltitude=function(t,e,i){for(var r=t+Math.floor(Math.random()*(e-t+1)),n=this.getAllInLand(!0);r>0;){var a=[],o=Math.floor(Math.random()*n.length),s=n[o];n.splice(o,1);var h,p,l=s.neighbor;for(h in l){p=l[h];var c=n.indexOf(p);c>=0&&n.splice(c,1)}var _=s.vertex[0];a.push(_.id);var u=40;_.elevation=u;for(var d,f=_.nears;f.length>0;){d=new Array,u-=i;for(h in f)if(_=f[h],!(a.indexOf(_.id)>=0)){a.push(_.id),_.elevation<u&&(_.elevation=u);for(h in _.nears)a.indexOf(_.nears[h].id)<0&&-1e5!=_.nears[h].elevation&&d.push(_.nears[h])}f=d}r--}},t.prototype.initRiver=function(t,e,i,r,n){var a,o,s,h,p,l,c,_=new Array;for(a in this._lakes)for(o=this._lakes[a],s=Math.floor(t+Math.random()*(e-t+1));s>0;){for(h=0;h<o.getAreas().length&&(p=this._areaDic.get(o.getAreas()[h]),this.isInWater(p));h++);for(l=p.vertex[Math.floor(p.vertex.length*Math.random())],c=new River,c.startArea=p,_.push(p),l.river++,c.downsteams.push(l),this._rivers.push(c);-1e5!=l.elevation&&(l=AreaPoint.findDownstream(l,c),null!=l);)l.river++,c.downsteams.push(l);s--}if(s=Math.floor(i+Math.random()*(r-i+1)),!(0>=s))for(var u=this.getAllInLand(!1,n,1e4);s>0;){do p=u[Math.floor(Math.random()*u.length)];while(_.indexOf(p)>=0);for(l=p.vertex[Math.floor(p.vertex.length*Math.random())],c=new River,c.startArea=p,_.push(p),l.river++,c.downsteams.push(l),this._rivers.push(c);-1e5!=l.elevation&&(l=AreaPoint.findDownstream(l,c),null!=l);)l.river++,c.downsteams.push(l);s--}},t.prototype.initHumidity=function(){var t,e,i,r,n=0;for(t in this._lakes)for(e=this._lakes[t],n=0;n<e.getAreas().length;n++){i=this._areaDic.get(e.getAreas()[n]);for(t in i.neighbor)r=i.neighbor[t],r.humidity+=Math.round(Math.random())+2}var a,o;for(t in this._rivers){a=this._rivers[t],a.startArea.humidity+=4;for(t in a.startArea.neighbor)r=a.startArea.neighbor[t],r.humidity+=1;var s=0;for(t in a.downsteams){s++,o=a.downsteams[t];for(t in o.areas){i=this._areaDic.get(o.areas[t]);var h=2/s-.1;h>1&&(h=1),.5>h?i.humidity+=.5:i.humidity+=h;for(t in i.neighbor)i.neighbor[t].humidity+=h}}}},t.prototype.findInTerrain=function(t){var e,i,r=new Array;for(e in this._areas)if(i=this._areas[e],i.type==t){var n=!0;for(e in i.neighbor)if(i.neighbor[e].type!=t){n=!1;break}n&&r.push(i)}return r},t.prototype.amendOasis=function(e){for(var i,r,n,a=this.findInTerrain(t.O_1),o=e;o>0&&a.length>0;){o--,i=Math.floor(Math.random()*a.length),r=a[i],a.splice(i,1);for(n in r.neighbor)a.indexOf(r.neighbor[n])>=0&&a.splice(a.indexOf(r.neighbor[n]),1);r.type=Math.random()>=.5?t.O_2:t.O_3}for(o=e,a=this.findInTerrain(t.W_1);o>0&&a.length>0;){o--,i=Math.floor(Math.random()*a.length),r=a[i],a.splice(i,1);for(n in r.neighbor)a.indexOf(r.neighbor[n])>=0&&a.splice(a.indexOf(r.neighbor[n]),1);r.type=Math.random()>=.5?t.W_2:t.W_3}},t.prototype.buildLand=function(){var e,i;for(e in this._areas)if(i=this._areas[e],!i.isWater){i.humidity=Math.round(i.humidity);for(var r=0,n=0;n<i.vertex.length;n++)r+=i.vertex[n].elevation;var a=r/i.vertex.length;if(a>30)switch(i.humidity){case 1:i.type=t.F_1;break;case 2:i.type=t.F_2;break;case 3:i.type=t.F_3;break;default:i.type=t.F_4}else if(a>20)switch(i.humidity){case 1:i.type=t.T_1;break;case 2:i.type=t.T_2;break;default:i.type=t.T_3}else if(a>10)switch(i.humidity){case 1:i.type=t.W_1;break;case 2:i.type=t.W_2;break;case 3:i.type=t.W_3;break;default:i.type=t.W_4}else switch(i.humidity){case 1:i.type=t.O_1;break;case 2:i.type=t.O_2;break;case 3:i.type=t.O_3;break;default:i.type=t.O_4}}},t.prototype.getMapBaseTextture=function(t,e){void 0===t&&(t=800),void 0===e&&(e=800);var i,r,n,a=t/this.sizeX,o=e/this.sizeY,s=new egret.Shape;for(r in this._areas){for(i=this._areas[r],s.graphics.lineStyle(2,i.type,1,!0),s.graphics.beginFill(i.type,1),s.graphics.moveTo(Math.floor(i.vertex[0].x*a),Math.floor(i.vertex[0].y*o)),n=1;n<i.vertex.length;n++)s.graphics.lineTo(Math.floor(i.vertex[n].x*a),Math.floor(i.vertex[n].y*o));s.graphics.lineTo(Math.floor(i.vertex[0].x*a),Math.floor(i.vertex[0].y*o)),s.graphics.endFill()}return s},t.prototype.getRiverTextture=function(e,i){void 0===e&&(e=800),void 0===i&&(i=800);var r=e/this.sizeX,n=i/this.sizeY,a=new egret.Shape;a.graphics.beginFill(0,.01),a.graphics.drawRect(0,0,e,i),a.graphics.endFill();var o,s,h,p;for(o in this._rivers)for(p=this._rivers[o],h=p.downsteams[0],a.graphics.lineStyle(1,t.LAKE,1,!0),a.graphics.moveTo(p.startArea.centerPoint.x*r,p.startArea.centerPoint.y*n),s=0;s<p.downsteams.length;s++)a.graphics.lineTo(p.downsteams[s].x*r,p.downsteams[s].y*n),p.downsteams[s].river>1?a.graphics.lineStyle(p.downsteams[s].river,t.LAKE,1,!0):a.graphics.lineStyle(1,t.LAKE,1,!0);return a},t.prototype.getBorn=function(){this.initGridDic();var t,e,i=this._lakes[0];for(t in i.getAreas()){e=this._areaDic.get(i.getAreas()[t]);for(t in e.neighbor)if(!e.neighbor[t].isWater)return new egret.Point(e.neighbor[t].centerPoint.x,e.neighbor[t].centerPoint.y)}return null},t.SEA=1068683,t.LAKE=1869550,t.F_4=16316664,t.F_3=14539965,t.F_2=12303291,t.F_1=10066329,t.T_3=13423804,t.T_2=12897468,t.T_1=15001547,t.W_4=10863529,t.W_3=11847850,t.W_2=12899244,t.W_1=15001547,t.O_4=10337193,t.O_3=11193253,t.O_2=12899244,t.O_1=15326664,t._fixFloorTypes=[t.SEA,t.LAKE,t.F_4,t.F_3,t.F_2,t.F_1,t.T_3,t.T_2,t.T_1,t.W_4,t.W_3,t.W_2,t.W_1,t.O_4,t.O_3,t.O_2,t.O_1],t.LAND=3771698,t}();__reflect(LloydMapData.prototype,"LloydMapData");var PlantData=function(){function t(){this._localAreaDic=new Object,this._areaData=new Map,this._plantsGrids=new Map}return t.prototype.resetConfig=function(){localStorage.setItem(Server_Map.T_MAP_PLANTS,JSON.stringify(this._localAreaDic))},t.prototype.loadConfig=function(){var t=localStorage.getItem(Server_Map.T_MAP_PLANTS);this._localAreaDic=JSON.parse(t)},t.prototype.createArea=function(t){this._localAreaDic[t]=!0,this._areaData.set(t,!0),this.resetConfig()},t.prototype.hasPlantArea=function(t){return null==this._localAreaDic[t]?!1:!0},t.prototype.initArea=function(t,e){var i=t.split("_"),r=Number(i[0]),n=Number(i[1]);this.insertPlants(r,n,e)},t.prototype.loadArea=function(t){if(null==this._areaData.get(t)){this._areaData.set(t,!0);var e=localStorage.getItem(Server_Map.T_MAP_PLANTS+t),i=JSON.parse(e);this.initArea(t,i)}},t.prototype.getAreaPlants=function(t){return this._plantsGrids.get(t)},t.prototype.insertPlants=function(t,e,i){var r,n,a,o=t*GameConfig.ROOM_CHECK_W,s=e*GameConfig.ROOM_CHECK_H,h=o+GameConfig.ROOM_CHECK_W,p=s+GameConfig.ROOM_CHECK_H;for(o;h>o;o+=GameConfig.ROOM_GRID_SIZE)for(var l=s;p>l;l+=GameConfig.ROOM_GRID_SIZE)n=Math.floor(o/GameConfig.ROOM_GRID_SIZE),a=Math.floor(l/GameConfig.ROOM_GRID_SIZE),this._plantsGrids.set(n+"_"+a,new Array);var c;for(c in i)r=i[c],this._plantsGrids.get(r.key).push(r)},t}();__reflect(PlantData.prototype,"PlantData");var PlayerData=function(){function t(){this.hp=0,this.full=0,this.lk=0,this.hpMax=0,this.fullMax=0,this.lkMax=0,this.time=0}return t}();__reflect(PlayerData.prototype,"PlayerData");var GameUI=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i==this.contentGroup&&this.adapComponent(i,AdaptiveType.CenterAdaptive),log(i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtnClick(this.newGame,!0),this.addBtnClick(this.oldGame,!0),this.addBtnClick(this.mapBtn,!0)},e.prototype.onClick=function(t){var e=t.currentTarget;switch(e){case this.newGame:log("新游戏"),this.currentState="game",GameManager.getIns().isNewGame=!0,GameManager.getIns().startNewGame();break;case this.oldGame:log("读取存档"),this.currentState="game",GameManager.getIns().isNewGame=!1,GameManager.getIns().startOldGame();break;case this.mapBtn:log("切换地图"),WinsManager.getIns().switchWin(MiniMap)}},e}(BaseComponent);__reflect(GameUI.prototype,"GameUI");var LanguageData=function(){function t(){this.langMap=new Map,this.langMap.set(10001,"正在创建世界..")}return t.getIns=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.getLang=function(t){return this.langMap.get(t)},t}();__reflect(LanguageData.prototype,"LanguageData");var LocalData=function(){function t(){}return t.loadLocalDataAsync=function(e,i,r){t._callback=i,t._thisObj=r,t._files=e,t.loadNextAsync()},t.loadNextAsync=function(){t._files.length<=0?(t._callback.apply(t._thisObj),t._callback=null,t._thisObj=null,t._files=null):(t._targetFile=t._files.pop(),RES.getResAsync(t._targetFile.substr(0,t._targetFile.length-2)+"_json",t.loadDbCompleteAsync,t))},t.loadDbCompleteAsync=function(e){t.createTable(t._targetFile,e),t.loadNextAsync()},t.loadLocalData=function(e){var i=[{id:1,name:"瓜哥",hpMax:100,lkMax:100,fullMax:100}];t.createTable(e,i)},t.createTable=function(e,i){var r=new LocalDataTable;return r.initTable(e,i),t._dataMap.set(e,r),r},t.getObjectByKv=function(e,i){return null==t._dataMap.get(e)&&t.loadLocalData(e),t._dataMap.get(e).getObject(i)},t.getObjectsByKv=function(e,i){return null==t._dataMap.get(e)&&t.loadLocalData(e),t._dataMap.get(e).getObjects(i)},t._dataMap=new Map,t}();__reflect(LocalData.prototype,"LocalData");var LocalDataTable=function(){function t(){this.datas=new Array}return t.prototype.initTable=function(t,e){this.name=t;for(var i,r,n=egret.getDefinitionByName(t);e.length>0;)i=e.pop(),r=new n,ObjectUtil.copyTo(i,r),this.datas.push(r)},t.prototype.getObject=function(t){for(var e,i,r=!1,n=0,a=this.datas;n<a.length;n++){e=a[n],r=!0;for(i in t)if(t[i]!=e[i]){r=!1;break}if(r)return e}return null},t.prototype.getObjects=function(t){for(var e,i,r=[],n=!1,a=0,o=this.datas;a<o.length;a++){e=o[a],n=!0;for(i in t)if(t[i]!=e[i]){n=!1;break}n&&r.push(e)}return r},t}();__reflect(LocalDataTable.prototype,"LocalDataTable");var AlignType=function(){function t(){}return t.TOP_LEFT="TOP_LEFT",t.TOP_CENTER="TOP_CENTER",t.TOP_RIGHT="TOP_RIGHT",t.CENTER="CENTER",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_CENTER="BOTTOM_CENTER",t.BOTTOM_RIGHT="BOTTOM_RIGHT",t.NONE="NONE",t}();__reflect(AlignType.prototype,"AlignType");var LayerType=function(){function t(){}return t.LAYER_GROUND="LAYER_GROUND",t.LAYER_MENU="LAYER_MENU",t.LAYER_UI="LAYER_UI",t.LAYER_POP="LAYER_POP",t}();__reflect(LayerType.prototype,"LayerType");var NodepErrorType=function(){function t(){}return t.LAYER_NO_EXISTENT="LAYER_NO_EXISTENT",t.PARAM_TYPE_ERROR="PARAM_TYPE_ERROR",t.ERROR_CODE="ERROR_CODE",t}();__reflect(NodepErrorType.prototype,"NodepErrorType");var RoleType=function(){function t(){}return t.ROLE_PLAYER="ROLE_PLAYER",t.ROLE_NPC="ROLE_NPC",t.ROLE_ANIMAL="ROLE_ANIMAL",t.ROLE_WILD="ROLE_WILD",t.POLE_PLANT="POLE_PLANT",t.PLANT_TREE="TREE",t.PLANT_COLL="COLL",t.GROUND_ITEM="GROUND_ITEM",t.ORE="ORE",t.TRAP="TRAP",t}();__reflect(RoleType.prototype,"RoleType");var StandType=function(){function t(){}return t.SEA=1,t.LAND=2,t.LAKE=3,t}();__reflect(StandType.prototype,"StandType");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.init(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.init=function(){App.GlobalObject.initObject(),App.LayerManager.initLayer(this)},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){App.GameController.startGame(App.LayerManager.GAME_SCENE_LAYER,App.LayerManager.GAME_UI_LAYER)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var LogTrace=function(){function t(){}return t.log=function(t){console.log(t)},t}();__reflect(LogTrace.prototype,"LogTrace");var RenderManager=function(){function t(){this._lastTime=0,this._renderList=new Array}return t.getIns=function(){return this._ins||(this._ins=new t),this._ins},t.prototype.startRender=function(t){void 0===t&&(t=App.UIAdapter.Stage),this._stage=t,this._lastTime=egret.getTimer(),this._stage.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},t.prototype.enterFrameHandler=function(t){var e,i=egret.getTimer(),r=i-this._lastTime;this._lastTime=i;for(e in this._renderList)this._renderList[e].renderUpdate(r)},t.prototype.registRender=function(t){this._renderList.push(t)},t.prototype.unregistRender=function(t){var e=this._renderList.indexOf(t);e>=0&&this._renderList.splice(e,1)},t.frameRate=30,t}();__reflect(RenderManager.prototype,"RenderManager");var WinsManager=function(){function t(){if(null!=t._ins)throw new Error("单例");this._layerMap=new Map,this._windowMap=new Map,LogTrace.log("create WinsManager!")}return t.prototype.initScale=function(){LogTrace.log(t.stageWidth+"_"+t.stageHeight),t.scaleX=t.stageWidth/1254,t.scaleY=t.scaleX},t.getIns=function(){return t._ins||(t._ins=new t),t._ins},t.prototype.initGame=function(e){this._baseUi=e,this._baseUi.stage.addEventListener(egret.Event.RESIZE,this.stageResizeHandler,this),t.stageWidth=this._baseUi.stage.stageWidth,t.stageHeight=this._baseUi.stage.stageHeight,this.initScale()},t.prototype.addLayer=function(t,e){this._layerMap.set(t,e),this._baseUi.addChild(e),LogTrace.log("add layer:"+t)},t.prototype.switchWin=function(t){this._windowMap.has(t)||this._windowMap.set(t,new t);var e=this._windowMap.get(t);null==e.stage?this.openWindow(t):this.closeWin(t)},t.prototype.openWindow=function(t){this._windowMap.has(t)||this._windowMap.set(t,new t);var e=this._windowMap.get(t);e.stage||DisplayUtility.addChild(App.LayerManager.EFFECT_LAYER,e)},t.prototype.openWindowToLayer=function(t,e){this._windowMap.has(t)||this._windowMap.set(t,new t);
var i=this._windowMap.get(t);if(!i.stage){if(!this._layerMap.has(e))throw new Error(NodepErrorType.LAYER_NO_EXISTENT);this._layerMap.get(e).addWindow(i),LogTrace.log("openWindow->"+i.typeName)}},t.prototype.closeWin=function(t){if(t){var e=this._windowMap.get(t);DisplayUtility.removeFromParent(e)}},t.prototype.updateWin=function(t,e,i){void 0===i&&(i=null),this._windowMap.forEach(function(r){e.indexOf(r.typeName)>=0&&null!=r.stage&&r.update(t,i)},this)},t.prototype.globalUpdate=function(t,e){this._windowMap.forEach(function(i){null!=i.stage&&i.update(t,e)},this)},t.prototype.stageResizeHandler=function(e){t.stageWidth=this._baseUi.stage.stageWidth,t.stageHeight=this._baseUi.stage.stageHeight,this.initScale(),LogTrace.log("stageReszie!"),this._layerMap.forEach(function(t){t.resize()},this)},t.prototype.gcWindow=function(t){},t.prototype.gcWindowAll=function(){},t.prototype.gameStage=function(){return App.UIAdapter.Stage},t.stageWidth=0,t.stageHeight=0,t.scaleX=1,t.scaleY=1,t}();__reflect(WinsManager.prototype,"WinsManager");var BitmapUtil=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t}();__reflect(BitmapUtil.prototype,"BitmapUtil");var DelayCall=function(){function t(t,e,i){void 0===i&&(i=null),this.delayTime=0,this.repeatCount=0,this._costTime=0,this._callBack=t,this._thisObject=e,this._args=i}return t.call=function(e,i,r,n,a){void 0===n&&(n=null),void 0===a&&(a=1);var o=new t(i,r,n);return o.delayTime=e,o.repeatCount=a,RenderManager.getIns().registRender(o),o},t.prototype.renderUpdate=function(t){this._costTime+=t,this._costTime>=this.delayTime&&(this.repeatCount>0?(this.repeatCount-=1,this.repeatCount<=0&&(RenderManager.getIns().unregistRender(this),null!=this._callBack&&this._callBack.apply(this._thisObject,this._args)),this._callBack=null,this._thisObject=null,this._args=null):(this._costTime=this._costTime-this.delayTime,null!=this._callBack&&this._callBack.apply(this._thisObject,this._args)))},t}();__reflect(DelayCall.prototype,"DelayCall",["IRender"]);var LinkArray=function(){function t(){this._autoLink=!1,this._list=new Array}return t.prototype.resetIteration=function(){this._ite=null},t.prototype.next=function(){return null==this._ite?this._ite=this._start:this._ite=this._ite.getNext(),this._ite},t.prototype.buildLink=function(t){this._sortArg=t;var e=this._sortArg;this._autoLink=!0,this._list.sort(function(t,i){return t[e]>i[e]?1:t[e]==i[e]?0:-1});var i,r=0;for(r;r<this._list.length;r++)i=this._list[r],this._list.length>r+1?i.setNext(this._list[r+1]):this._end=i,0==r?this._start=i:i.setPre(this._list[r-1])},t.prototype.swapNear=function(t,e){var i=this._list.indexOf(t),r=i+e,n=this._list[r];this._list[r]=t,this._list[i]=n,-1==e?(t.setPre(n.getPre()),n.setNext(t.getNext()),n.setPre(t),t.setNext(n),null!=t.getPre()&&t.getPre().setNext(t),null!=n.getNext()&&n.getNext().setPre(n)):(t.setNext(n.getNext()),n.setPre(t.getPre()),n.setNext(t),t.setPre(n),null!=t.getNext()&&t.getNext().setPre(t),null!=n.getPre()&&n.getPre().setNext(n))},t.prototype.put=function(t){return this._autoLink?0==this._list.length?(this._list.push(t),0):this.insertEle(t,0,this._list.length):(this._list.push(t),this._list.length-1)},t.prototype.remove=function(t){var e=this._list.indexOf(t);if(!(0>e)){this._list.splice(e,1);var i=t;null!=i.getNext()&&i.getNext().setPre(i.getPre()),null!=i.getPre()&&i.getPre().setNext(i.getNext()),i.setPre(null),i.setNext(null)}},t.prototype.insertEle=function(t,e,i){if(e!=i){if(t[this._sortArg]<=this._list[e][this._sortArg])return this.insertEle(t,e,e);if(t[this._sortArg]>=this._list[i-1][this._sortArg])return this.insertEle(t,i,i);var r=Math.floor((i-e)/2)+e;return t[this._sortArg]<=this._list[r][this._sortArg]?this.insertEle(t,e,r):this.insertEle(t,r,i)}var n=this._list.length;return this._list.splice(e,0,t),0==e?(this._start=t,this._list.length>e+1&&(this._list[e].setNext(this._list[e+1]),this._list[e+1].setPre(this._list[e]))):e>=n?(this._end=t,this._list[e].setPre(this._list[e-1]),this._list[e-1].setNext(this._list[e])):(this._list[e].setPre(this._list[e-1]),this._list[e].setNext(this._list[e+1]),this._list[e+1].setPre(this._list[e]),this._list[e-1].setNext(this._list[e])),e},t}();__reflect(LinkArray.prototype,"LinkArray");var MapUtil=function(){function t(){}return t.getDiamondKeyX_YFromPos=function(t,e,i,r){t+=i/2;var n=Math.floor(t/i),a=Math.floor(e/r),o=t-n*i,s=e-a*r,h=o/s>=2,p=(i-o)/s>=2;return h?p?n+"_"+2*a:n+"_"+(2*a+1):p?n-1+"_"+(2*a+1):n+"_"+(2*a+2)},t.getPosByGrid=function(t,e){var i=new egret.Point;return e%2==0?(i.x=t*GameConfig.GRID_W,i.y=e/2*GameConfig.GRID_H):(i.x=t*TiledFloorBase.GW+GameConfig.GRID_W/2,i.y=(e-1)/2*TiledFloorBase.GH+GameConfig.GRID_H/2),i},t.getRoomPosByPosition=function(t,e){var i=new egret.Point;return i.x=Math.floor(t/GameConfig.ROOM_CHECK_W),i.y=Math.floor(e/GameConfig.ROOM_CHECK_H),i},t}();__reflect(MapUtil.prototype,"MapUtil");var ObjectUtil=function(){function t(){}return t.copyTo=function(t,e){var i;for(i in t)e[i]=t[i]},t}();__reflect(ObjectUtil.prototype,"ObjectUtil");var PerlinNoiseUtil=function(){function t(){}return t.noise2D=function(e,i){var r=[];t.seed=Math.floor(1376312589*Math.random());var n=10,a=Math.floor(e/n),o=Math.floor(i/n),s=0,h=Math.floor(5*Math.random()),p=Math.floor(5*Math.random());for(s;e>s;s++){r[s]=new Array;for(var l=0;i>l;l++){var c=t.insertNum_2D(s/a+h,l/o+p),_=Math.floor(255*c);r[s][l]=_}}return r},t.getSmoothNoise2D=function(e,i){var r=1,n=(t.getNoise2D(e-r,i-r)+t.getNoise2D(e+r,i-r)+t.getNoise2D(e-r,i+r)+t.getNoise2D(e+r,i+r))/16,a=(t.getNoise2D(e-r,i)+t.getNoise2D(e+r,i)+t.getNoise2D(e,i-r)+t.getNoise2D(e,i+r))/8,o=t.getNoise2D(e,i)/4;return n+a+o},t.getNoise2D=function(e,i){var r=e+57*i;return r=r<<13^r,r=1-(r*(r*r*15731+789221)+t.seed&2147483647)/1073741824,r=Math.abs(r)},t.insertNum_2D=function(e,i){var r=Math.floor(e),n=e-r,a=Math.floor(i),o=i-a,s=t.getSmoothNoise2D(r,a),h=t.getSmoothNoise2D(r+1,a),p=t.getSmoothNoise2D(r,a+1),l=t.getSmoothNoise2D(r+1,a+1),c=t.insertNum_2(s,h,n),_=t.insertNum_2(p,l,n);return t.insertNum_2(c,_,o)},t.insertNum_2=function(t,e,i){var r=3.1415927*i,n=.5*(1-Math.cos(r));return t*(1-n)+e*n},t.seed=0,t}();__reflect(PerlinNoiseUtil.prototype,"PerlinNoiseUtil");var SystemTimer=function(){function t(){}return t.init=function(){t._startTime=(new Date).getTime()},t.getTimer=function(){return(new Date).getTime()-t._startTime},t}();__reflect(SystemTimer.prototype,"SystemTimer");var TimeUtil=function(){function t(){}return t.getTimeStrByHM=function(t,e){var i="";return i+=t>=10?t+":":"0"+t+":",i+=e>=10?e:"0"+e},t}();__reflect(TimeUtil.prototype,"TimeUtil");var TriangleUtil=function(){function t(){}return t.getCircumcircleR=function(t){var e=t.vertex[0].x,i=t.vertex[1].x,r=t.vertex[2].x,n=t.vertex[0].y,a=t.vertex[1].y,o=t.vertex[2].y,s=Math.sqrt((e-i)*(e-i)+(n-a)*(n-a)),h=Math.sqrt((e-r)*(e-r)+(n-o)*(n-o)),p=Math.sqrt((i-r)*(i-r)+(a-o)*(a-o)),l=(s+h+p)/2,c=Math.sqrt(l*(l-s)*(l-h)*(l-p)),_=s*h*p/(4*c);return _},t.getCircumcirclePoint=function(t){var e=new Point2D,i=t.vertex[0].x,r=t.vertex[1].x,n=t.vertex[2].x,a=t.vertex[0].y,o=t.vertex[1].y,s=t.vertex[2].y,h=i*i+a*a,p=r*r+o*o,l=n*n+s*s,c=i*o+r*s+n*a-i*s-r*a-n*o;return e.x=(p*s+h*o+l*a-p*a-l*o-h*s)/c/2,e.y=(l*r+p*i+h*n-h*r-p*n-l*i)/c/2,e},t.isInCircumcircle=function(t,e){var i=t.x-e.center.x,r=t.y-e.center.y;return Math.sqrt(i*i+r*r)<=e.circumR},t.isAdjacent=function(t,e){var i,r;for(r in t.edges){i=t.edges[r];var n;for(r in e.edges)if(n=e.edges[r],i.id==n.id)return!0}return!1},t.distance=function(t,e){return Math.abs(Math.sqrt(t*t+e*e))},t}();__reflect(TriangleUtil.prototype,"TriangleUtil");var Edge2D=function(){function t(t,e){t.id>e.id?(this.startPoint=e,this.endPoint=t):(this.startPoint=t,this.endPoint=e),this.id=this.startPoint.id+"_"+this.endPoint.id}return t}();__reflect(Edge2D.prototype,"Edge2D");var LloydUtil=function(){function t(t,e,i){this._points=new Array;for(var r,n=0;n<t.length;)r=new Point2D(t[n],t[n+1]),this._points.push(r),n+=2;this._maxW=e,this._maxH=i}return t.prototype.getPolgons=function(){return this._polgons},t.prototype.delaunay=function(){this._tris=new Array,this._assistPoints=[new Point2D(this._maxW/2,-1e4),new Point2D(this._maxW+1e4,this._maxH),new Point2D(-1e4,this._maxH)],this.addTri([this._assistPoints[0],this._assistPoints[1],this._assistPoints[2]]);for(var t,e=0;e<this._points.length;)t=this._points[e],this.insertPoint(t),e++},t.prototype.insertPoint=function(t){for(var e=this.findInsideTri(t),i=this.delEdgeInCommon(e);e.length>0;)this.delTri(e.pop());for(;i.length>0;){var r=i.pop();this.addTri([t,r.startPoint,r.endPoint])}},t.prototype.findInsideTri=function(t){var e,i,r=[];for(e in this._tris)i=this._tris[e],TriangleUtil.isInCircumcircle(t,i)&&r.push(i);return r},t.prototype.delEdgeInCommon=function(t){var e,i,r=[],n=[],a=[];for(e in t){i=t[e];var o;for(e in i.edges)o=i.edges[e],r.indexOf(o.id)<0?(r.push(o.id),a.push(o)):n.push(o.id)}var s=a.length-1;for(s;s>=0;s--)n.indexOf(a[s].id)>=0&&a.splice(s,1);return a},t.prototype.delTri=function(t){this._tris.splice(this._tris.indexOf(t),1),t.del()},t.prototype.addTri=function(t){var e=new Array(3);e[0]=t[0],e[1]=t[1],e[2]=t[2];var i=new Tri2D(e);return this._tris.push(i),i},t.prototype.optimization=function(){var e;for(e in this._polgons)this._polgons[e].moveToFocus(t.getFoucsPoint(this._polgons[e]));this._tris=[];var i;for(e in this._points)i=this._points[e],i.tris=[];this.delaunay(),this.voronoi()},t.getFoucsPoint=function(t){for(var e=0,i=0,r=0,n=0,a=0;a<t.vertex.length;a++){var o=a,s=a+1;s==t.vertex.length&&(s=0),e=this.cross(t.vertex[o],t.vertex[s])/2,i+=e,r+=e*(t.vertex[o].x+t.vertex[s].x)/3,n+=e*(t.vertex[o].y+t.vertex[s].y)/3}return new egret.Point(r/i,n/i)},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t.prototype.voronoi=function(){this._polgons=new Array;var t,e;for(t in this._points){e=this._points[t];var i=this.createPolygon(e);i.cutself(this._maxW,this._maxH),i.vertex.length>=3?this._polgons.push(i):LogTrace.log("数据异常：四边形的边的数量异常")}},t.prototype.findAdjacent=function(t,e,i){var r,n,a=null;for(r in i)if(n=i[r],!(e.indexOf(n)>=0)&&TriangleUtil.isAdjacent(t,n)){a=n;break}return a},t.prototype.createPolygon=function(t){for(var e=t.tris,i=e[0],r=[i],n=this.findAdjacent(i,r,e),a=n,o=2;null!=n;)r.push(n),a=n,n=this.findAdjacent(n,r,e),o++;TriangleUtil.isAdjacent(a,i)&&o>=3||LogTrace.log("存在无法构造的多边形");for(var s=new Array,h=0;h<r.length;h++)s.push(r[h].center);var p=new Pol2D(s);return p.centerPoint=t,p},t.prototype.screwFind=function(t,e,i){var r=new egret.Point;return i.x==i.y&&i.x>=0&&i.y>=0?i.y=i.y+1:Math.abs(i.x)==Math.abs(i.y)?i.x<0&&i.y>0?i.y=i.y-1:i.x<0&&i.y<0?i.x=i.x+1:i.y=i.y+1:Math.abs(i.y)>Math.abs(i.x)?i.y>0?i.x=i.x-1:i.x=i.x+1:i.x>0?i.y=i.y+1:i.y=i.y-1,r.x=i.x+t,r.y=i.y+e,r},t.prototype.findOwnTris=function(t){var e,i,r=[];for(i in this._tris)e=this._tris[i],e.vertex.indexOf(t)>=0&&r.push(e);return r},t.prototype.getTestShape=function(){var t=new egret.Shape;t.graphics.lineStyle(1,255,2);var e,i;for(i in this._polgons){e=this._polgons[i],t.graphics.beginFill(16711680,.5),t.graphics.moveTo(e.vertex[0].x,e.vertex[0].y);for(var r=1;r<e.vertex.length;r++)t.graphics.lineTo(e.vertex[r].x,e.vertex[r].y);t.graphics.lineTo(e.vertex[0].x,e.vertex[0].y),t.graphics.endFill()}return t},t}();__reflect(LloydUtil.prototype,"LloydUtil");var Point2D=function(t){function e(i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=t.call(this,i,r)||this;return n.tris=[],n.id=++e._tid,n}return __extends(e,t),e._tid=0,e}(egret.Point);__reflect(Point2D.prototype,"Point2D");var Pol2D=function(){function t(t){this.isos=!1,this.vertex=t}return t.prototype.moveToFocus=function(t){this.centerPoint.x=t.x,this.centerPoint.y=t.y},t.prototype.cutself=function(t,e){var i,r,n=[];for(i in this.vertex)r=this.vertex[i],this.isOutside(t,e,r)&&this.isOutside(t,e,this.getPrePoint(r))&&this.isOutside(t,e,this.getNextPoint(r))&&n.push(r);for(;n.length>0;)r=n.pop(),this.vertex.splice(this.vertex.indexOf(r),1);var a=0;for(i in this.vertex)r=this.vertex[i],this.isOutside(t,e,r)&&(n.push(r),a++);if(0!=a){this.isos=a>0,a>2&&LogTrace.log("数据异常：存在超过2个点在裁切以后外框以外的多边形");var o,s,h,p;if(1==a)for(o=this.getIntersect(t,e,n[0],this.getPrePoint(n[0])),h=this.vertex.indexOf(this.getPrePoint(n[0])),this.vertex.splice(h+1,0,o),s=this.getIntersect(t,e,n[0],this.getNextPoint(n[0])),p=this.vertex.indexOf(this.getNextPoint(n[0])),this.vertex.splice(p-1,0,s);n.length>0;)r=n.pop(),this.vertex.splice(this.vertex.indexOf(r),1);else if(2==a){if(this.isOutside(t,e,this.getPrePoint(n[0]))?(this.isOutside(t,e,this.getPrePoint(n[0]))||LogTrace.log("数据异常：存在超过2个点在裁切以后外框以外的多边形"),o=this.getIntersect(t,e,n[0],this.getNextPoint(n[0])),h=this.vertex.indexOf(n[0]),s=this.getIntersect(t,e,n[1],this.getPrePoint(n[1])),p=this.vertex.indexOf(n[1]),this.vertex[h]=o,this.vertex[p]=s):(this.isOutside(t,e,this.getNextPoint(n[0]))||LogTrace.log("数据异常：存在超过2个点在裁切以后外框以外的多边形"),o=this.getIntersect(t,e,n[0],this.getPrePoint(n[0])),h=this.vertex.indexOf(n[0]),this.vertex[h]=o,s=this.getIntersect(t,e,n[1],this.getNextPoint(n[1])),p=this.vertex.indexOf(n[1]),this.vertex[p]=s),o.x==s.x||o.y==s.y)return;var l=0,c=0;0==o.x||o.x==t?l=o.x:0==s.x||s.x==t?l=s.x:LogTrace.log("数据异常：裁切以后边不在边框上"),0==o.y||o.y==e?c=o.y:0==s.y||s.y==e?c=s.y:LogTrace.log("数据异常：裁切以后边不在边框上"),this.getPrePoint(o)==s?this.vertex.splice(this.vertex.indexOf(s)+1,0,new Point2D(l,c)):this.getPrePoint(s)==o?this.vertex.splice(this.vertex.indexOf(o)+1,0,new Point2D(l,c)):LogTrace.log("数据异常：插入点有问题")}}},t.prototype.isOutside=function(t,e,i){return i.x<0||i.y<0||i.x>t||i.y>e},t.prototype.getPointByID=function(t){var e,i,r;for(i in this.vertex)if(r=this.vertex[i],r.id==t){e=r;break}return e},t.prototype.getPrePoint=function(t){var e,i=this.vertex.indexOf(t);return 0>i?null:(e=0==i?this.vertex[this.vertex.length-1]:this.vertex[i-1],e==t&&LogTrace.log("数据异常：这个四边形只有两个点"),e)},t.prototype.getNextPoint=function(t){var e,i=this.vertex.indexOf(t);return 0>i?null:(e=i==this.vertex.length-1?this.vertex[0]:this.vertex[i+1],e==t&&LogTrace.log("数据异常：这个四边形只有两个点"),e)},t.prototype.getIntersect=function(t,e,i,r){var n,a;if((i.x<0||i.x>t)&&(i.y<0||i.y>e)){var o,s;i.y<0?(s=(r.y-i.y)/r.y,o=i.x<0?(r.x-i.x)/r.x:(i.x-r.x)/(t-r.x)):(s=(i.y-r.y)/(e-r.y),o=i.x<0?(r.x-i.x)/r.x:(i.x-r.x)/(t-r.x)),o>s?i.x<0?(n=r.x-i.x,a=r.x):(n=i.x-r.x,a=t-r.x):i.y<0?(n=r.y-i.y,a=r.y):(n=i.y-r.y,a=e-r.y)}else i.x<0||i.x>t?i.x<0?(n=r.x-i.x,a=r.x):(n=i.x-r.x,a=t-r.x):i.y<0?(n=r.y-i.y,a=r.y):(n=i.y-r.y,a=e-r.y);var h=egret.Point.interpolate(i,r,a/n);return Math.abs(h.x)<2?h.x=0:Math.abs(t-h.x)<2&&(h.x=t),Math.abs(h.y)<2?h.y=0:Math.abs(h.y-e)<2&&(h.y=e),new Point2D(h.x,h.y)},t}();__reflect(Pol2D.prototype,"Pol2D");var RandomPointUtil=function(){function t(){}return t.getRandomPoints=function(t,e,i,r){for(var n,a,o,s=new Array,h=new Array;r>0;)n=Math.floor(Math.random()*(t-2*i)+i),a=Math.floor(Math.random()*(t-2*i)+i),o=n+"_"+a,s.indexOf(o)>=0||(s.push(o),r--,h.push(n),h.push(a));return s=null,h},t}();__reflect(RandomPointUtil.prototype,"RandomPointUtil");var Tri2D=function(){function t(t,e){void 0===e&&(e=!0),this.inited=!1,this.circumR=0,this.edges=new Array(3),this.isAssist=!1,this.vertex=t,this.vertex[0].tris.push(this),this.vertex[1].tris.push(this),this.vertex[2].tris.push(this),this.inited=e,this.edges[0]=new Edge2D(t[0],t[1]),this.edges[1]=new Edge2D(t[1],t[2]),this.edges[2]=new Edge2D(t[2],t[0]),this.inited&&this.flush()}return t.prototype.flush=function(){this.inited=!0,this.center=TriangleUtil.getCircumcirclePoint(this),this.circumR=TriangleUtil.getCircumcircleR(this)},t.prototype.del=function(){this.vertex[0].tris.splice(this.vertex[0].tris.indexOf(this),1),this.vertex[1].tris.splice(this.vertex[1].tris.indexOf(this),1),this.vertex[2].tris.splice(this.vertex[2].tris.indexOf(this),1)},t}();__reflect(Tri2D.prototype,"Tri2D");var AlertWindow=function(t){function e(){var e=t.call(this)||this;return e.layerType=LayerType.LAYER_POP,e.typeName=WindowType.ALERT_WIN,e.pop=!0,e.align(AlignType.CENTER,0,0),e}return __extends(e,t),e.alertShow=function(t,i,r,n){void 0===n&&(n=null),e._message=t,e._callBack=i,e._thisObject=r,e._labels=n,WinsManager.getIns().openWindow(e)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.getChildByName("okBtn").addEventListener(egret.TouchEvent.TOUCH_TAP,this.handler,this),this.getChildByName("cancelBtn").addEventListener(egret.TouchEvent.TOUCH_TAP,this.handler,this),this.reOpen()},e.prototype.handler=function(t){null!=e._callBack&&e._callBack.apply(e._thisObject,["okBtn"==t.currentTarget.name]),WinsManager.getIns().closeWin(this)},e.prototype.reOpen=function(){t.prototype.reOpen.call(this),this.getChildByName("infoTxt").text=e._message},e}(GameWindow);__reflect(AlertWindow.prototype,"AlertWindow",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var HBox=function(){function t(){}return t}();__reflect(HBox.prototype,"HBox");var VBox=function(){function t(){}return t}();__reflect(VBox.prototype,"VBox");var FogForGrid=function(t){function e(){var e=t.call(this)||this;return e.autoDraw=!1,e}return __extends(e,t),e.getIns=function(){return null==e._ins&&(e._ins=new e),e._ins},e.prototype.initBase=function(t,e){this._w=t,this._h=e,this._fw=50,this._bitmap=new egret.Bitmap,this.addChild(this._bitmap),this._bgSh=new egret.Shape,this._bgSh.graphics.beginFill(0,1),this._bgSh.graphics.drawRect(0,0,t,e),this._bgSh.graphics.endFill(),this._con=new egret.DisplayObjectContainer,this._con.addChild(this._bgSh),this._fogLayer=new egret.DisplayObjectContainer,this._con.addChild(this._fogLayer),this._fogLayerShape=new egret.Shape,this._fogLayer.addChild(this._fogLayerShape),this._fogLayer.blendMode=egret.BlendMode.ERASE},e.prototype.rebuild=function(t,e){this.initBase(t,e);var i=localStorage.getItem(Server_Map.T_MAP_MINI),r=egret.BitmapData.create("base64",i),n=new egret.Texture;n.bitmapData=r,this._fogLayer.addChild(new egret.Bitmap(n)),this.reDraw()},e.prototype.init=function(t,e){this.initBase(t,e),this.saveMiniMap()},e.prototype.updateFogs=function(){this._fogLayerShape.graphics.beginFill(0,1),this._fogLayerShape.graphics.drawCircle(this._w*PlayerRole.self.x/GameConfig.WORD_W,this._h*PlayerRole.self.y/GameConfig.WORD_H,this._fw),this._fogLayerShape.graphics.endFill(),this.autoDraw&&this.reDraw()},e.prototype.reDraw=function(){var t=new egret.RenderTexture;t.drawToTexture(this._con),this._bitmap.texture&&this._bitmap.texture.dispose(),this._bitmap.texture=t},e.prototype.saveMiniMap=function(){this._fogLayer.blendMode=egret.BlendMode.NORMAL;var t=new egret.RenderTexture;t.drawToTexture(this._fogLayer);var e=t.toDataURL("image/png");e.indexOf(",")>=0&&(e=e.split(",")[1]),localStorage.setItem(Server_Map.T_MAP_MINI,e),t.dispose(),this._fogLayer.blendMode=egret.BlendMode.ERASE},e}(egret.DisplayObjectContainer);__reflect(FogForGrid.prototype,"FogForGrid");var ProgressBar=function(){function t(t){this._maxWidth=0,this._maxHeight=0,this._cur=-1,this._total=-1,this._maskShape=new egret.Shape,t.mask=this._maskShape,this._maskShape.x=t.x,this._maskShape.y=t.y,t.parent.addChild(this._maskShape),this._maxWidth=t.width,this._maxHeight=t.height}return t.prototype.setProgress=function(t,e){this._maskShape.graphics.clear(),this._maskShape.graphics.beginFill(0,1),this._maskShape.graphics.drawRect(0,0,Math.trunc(this._maxWidth*t/e),this._maxHeight),this._maskShape.graphics.endFill()},t}();__reflect(ProgressBar.prototype,"ProgressBar");var RockBarContorller=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return t._instance?t._instance:t._instance=new RockerBar},enumerable:!0,configurable:!0}),t.multX=0,t.multY=0,t.offset=0,t._instance=null,t}();__reflect(RockBarContorller.prototype,"RockBarContorller");var GameLayer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._wins=[],e._popCount=0,e}return __extends(e,t),e.prototype.addWindow=function(t){t.visible=!1,this.addChild(t),this._wins.push(t),t.pop&&this._popCount++,this.updateModel(),t.__inited&&t.reOpen(),t.__inited=!0},e.prototype.removeWindow=function(t){t.pop&&this._popCount--,this.updateModel(),this.removeChild(t),this._wins.splice(this._wins.indexOf(t),1)},e.prototype.updateModel=function(){!(this._popCount>0)||this._popShape&&this._popShape.parent?this._popCount<=0&&this._popShape&&this._popShape.parent&&(this.removeChild(this._popShape),this._popShape.graphics.clear(),this._popShape=null):(this._popShape||(this._popShape=new egret.Shape),this._popShape.graphics.clear(),this._popShape.graphics.beginFill(0,.7),this._popShape.graphics.drawRect(0,0,WinsManager.stageWidth,WinsManager.stageHeight),this._popShape.graphics.endFill,this._popShape.touchEnabled=!0,this.addChildAt(this._popShape,0))},e.prototype.resize=function(){var t;for(t in this._wins)this._wins[t].resize()},e}(egret.DisplayObjectContainer);__reflect(GameLayer.prototype,"GameLayer",["GameLayerInterface"]);var FloorLayer=function(t){function e(i,r){var n=t.call(this)||this;return n._startX=-1e4,n._startY=-1e4,n._gridX_from=-1,n._gridX_to=-1,n._gridY_from=-1,n._gridY_to=-1,n._balance=5,n._addCount=0,n._floorMap=new Map,n._errorFloor=new Array,n._preAddFloors=[],n._errorFloorDic=new Map,n._changeDrawCount=0,e.floorSelf=n,n._offsetW=GameConfig.OFFSET_W,n._offsetH=GameConfig.OFFSET_H,n._gridW=GameConfig.GRID_W,n._gridH=GameConfig.GRID_H,n._gridW_HALF=n._gridW/2,n._gridH_HALF=n._gridH/2,n._wCount=Math.round((WinsManager.getIns().gameStage().stageWidth/WinsManager.scaleX+2*n._offsetW)/n._gridW)+2,n._hCount=Math.round((WinsManager.getIns().gameStage().stageHeight/WinsManager.scaleY+2*n._offsetH)/n._gridH)+3,n._hCount=2*n._hCount,n._maxGridW=Math.floor(i/n._gridW),n._maxGridH=Math.floor(r/n._gridH*2),TiledFloorBase.GW=n._gridW,TiledFloorBase.GH=n._gridH,TiledFloorBase.GW_HALF=n._gridW/2,TiledFloorBase.GH_HALF=n._gridH/2,n}return __extends(e,t),e.prototype.getStandType=function(t,e){var i=MapUtil.getDiamondKeyX_YFromPos(t,e,this._gridW,this._gridH),r=this._floorMap.get(i);switch(this._standOn=r,r.getType()){case LloydMapData.SEA:return StandType.SEA;case LloydMapData.LAKE:return StandType.LAKE;default:return StandType.LAND}},e.prototype.preAddFloor=function(t,e){var i=t+"_"+e;null==this._floorMap.get(i)&&(this._preAddFloors.push(t),this._preAddFloors.push(e))},e.prototype.balanceAddFloor=function(t,e){var i=t+"_"+e;if(null==this._floorMap.get(i)){this._addCount++;var r=new TiledFloorBase;r.createFloor(this,t,e),this._floorMap.set(i,r),r.fType<0&&r.reCreate(this.getRealType(r.fType,r.x,r.y))}},e.prototype.addFloor=function(t,e){var i=t+"_"+e;if(null==this._floorMap.get(i)){var r=new TiledFloorBase;r.createFloor(this,t,e),this._floorMap.set(i,r),r.fType<0&&this._errorFloor.push(r)}},e.prototype.delFloor=function(t){null!=this._floorMap.get(t)&&(this._floorMap.get(t).removeFloor(),this._floorMap["delete"](t))},e.prototype.changeDeleteAndCreate=function(t,e,i,r){var n=this._gridX_from,a=this._gridY_from;for(n;n<=this._gridX_to;n++)for(a=this._gridY_from;a<=this._gridY_to;a++)(t>n||n>e||i>a||a>r)&&this.delFloor(n+"_"+a);for(n=t,a=i,n;e>=n;n++)for(a=i;r>=a;a++)this.preAddFloor(n,a);this._gridX_from=t,this._gridX_to=e,this._gridY_from=i,this._gridY_to=r},e.prototype.initCreate=function(t,e,i,r){var n,a;for(this._addCount=0,n=t,a=i,n;e>=n;n++)for(a=i;r>=a;a++)this.addFloor(n,a);for(;this._errorFloor.length>0;){var o=this._errorFloor.pop();o.reCreate(this.getRealType(o.fType,o.x,o.y))}this._gridX_from=t,this._gridX_to=e,this._gridY_from=i,this._gridY_to=r},e.prototype.getRealType=function(t,e,i){return null!=this._errorFloorDic.get(e+"_"+i)?this._errorFloorDic.get(e+"_"+i):(t=Tiled_Ground.getIns().getFloorTypeByArea(e+this._gridW_HALF,i+this._gridH_HALF),this._errorFloorDic.set(e+"_"+i,t),t)},e.prototype.initTileds=function(t,e){var i=Math.floor(t/this._gridW)-1,r=i+this._wCount,n=2*(Math.floor(e/this._gridH)-1),a=n+this._hCount;0>i&&(i=0),r>this._maxGridW&&(r=this._maxGridW),0>n&&(n=0),a>this._maxGridH&&(a=this._maxGridH),this.initCreate(i,r,n,a)},e.prototype.synTileds=function(t,e){var i=Math.floor(t/this._gridW)-1,r=i+this._wCount,n=2*(Math.floor(e/this._gridH)-1),a=n+this._hCount;0>i&&(i=0),r>this._maxGridW&&(r=this._maxGridW),0>n&&(n=0),a>this._maxGridH&&(a=this._maxGridH),this.changeDeleteAndCreate(i,r,n,a)},e.prototype.initPosition=function(t,e){this._startX=t,this._startY=e,this.initTileds(this._startX-this._offsetW,this._startY-this._offsetH)},e.prototype.synPosition=function(t,e){if((Math.abs(this._startX-t)>this._offsetW||Math.abs(this._startY-e)>this._offsetH)&&(this._changeDrawCount++,this._changeDrawCount>=10&&(this._errorFloorDic.clear(),this._changeDrawCount=0),this._preAddFloors=[],this._startX=t,this._startY=e,this.synTileds(this._startX-this._offsetW,this._startY-this._offsetH)),this._preAddFloors.length<=0)return!0;for(this._addCount=0;this._preAddFloors.length>0&&this._addCount<this._balance;)this.balanceAddFloor(this._preAddFloors.shift(),this._preAddFloors.shift());return!1},e}(egret.DisplayObjectContainer);__reflect(FloorLayer.prototype,"FloorLayer");var GroundLayer=function(t){function e(e,i,r,n){var a=t.call(this)||this;return a._maxW=e/WinsManager.scaleX,a._maxH=i/WinsManager.scaleY,a._worldW=r,a._worldH=n,a._hafX=a._maxW/2,a._hafY=a._maxH/2,a._maxOffsetX=-a._worldW+a._maxW+GameConfig.GRID_W/2,a._maxOffsetY=-a._worldH+a._maxH,a._floor=new FloorLayer(r,n),a.addChild(a._floor),a._stage=new StageLayer(r,n),a.addChild(a._stage),a}return __extends(e,t),e.prototype.initPosition=function(t,e){this._toX=-t+this._hafX,this._toY=-e+this._hafY,this._toX>0?this._toX=0:this._toX<this._maxOffsetX&&(this._toX=this._maxOffsetX),this._toY>0?this._toY=0:this._toY<this._maxOffsetY&&(this._toY=this._maxOffsetY),this.x=this._toX,this.y=this._toY,this._floor.initPosition(-this.x,-this.y),this._stage.initSynArea(-this.x,-this.y)},e.prototype.synPositionTo=function(t,e){this._toX=-t+this._hafX,this._toY=-e+this._hafY,this._toX>0?this._toX=0:this._toX<this._maxOffsetX&&(this._toX=this._maxOffsetX),this._toY>0?this._toY=0:this._toY<this._maxOffsetY&&(this._toY=this._maxOffsetY),this.x=this._toX,this.y=this._toY,this._floor.synPosition(-this.x,-this.y)&&this._stage.trySynArea(-this.x,-this.y)},e.prototype.addRole=function(t){this._stage.addRoleToLink(t)},e}(egret.DisplayObjectContainer);__reflect(GroundLayer.prototype,"GroundLayer");var StageLayer=function(t){function e(i,r){var n=t.call(this)||this;return n._startX=-1e5,n._startY=-1e5,n._gridX_from=-1,n._gridX_to=-1,n._gridY_from=-1,n._gridY_to=-1,n._step=-1,n._roleGirds=new Map,n._hitTestArray=[],n._hitTestPoint=new egret.Point(-1,-1),e.self=n,n._roleLink=new LinkArray,n._roomMaker=new RoomMaker,n._wordW=i,n._wordH=r,n._wCount=Math.round((WinsManager.getIns().gameStage().stageWidth/WinsManager.scaleX+2*GameConfig.ROOM_GRID_SIZE)/GameConfig.ROOM_GRID_SIZE),n._hCount=Math.round((WinsManager.getIns().gameStage().stageHeight/WinsManager.scaleY+2*GameConfig.ROOM_GRID_SIZE)/GameConfig.ROOM_GRID_SIZE)+1,n._maxRollW=Math.floor(GameConfig.WORD_W/GameConfig.ROOM_GRID_SIZE),n._maxRollH=Math.floor(GameConfig.WORD_H/GameConfig.ROOM_GRID_SIZE),e.__xGridCount=Math.floor(n._wordW/FloorLayer.floorSelf._gridW),e.__yGridCount=2*Math.floor(n._wordH/FloorLayer.floorSelf._gridH),n}return __extends(e,t),e.prototype.addAreaInit=function(t,e){var i,r,n,a=t+"_"+e,o=GameData.plantData.getAreaPlants(a);for(i in o)r=o[i],n=PlantMaker.getPlant(r),this.addRoleToLink(n,a)},e.prototype.delArea=function(t){var e=this._roleGirds.get(t);if(null!=e)for(;e.length>0;)this.removeRoleFromLink(e.pop());this._roleGirds["delete"](t)},e.prototype.preAddArea=function(t,e){var i,r,n,a=t+"_"+e,o=GameData.plantData.getAreaPlants(a);for(i in o)r=o[i],n=PlantMaker.getPlant(r),this.addRoleToLink(n,a)},e.prototype.initSynArea=function(t,e){this._rollPx=t,this._rollPy=e;var i=MapUtil.getRoomPosByPosition(t,e);this._startX=i.x,this._startY=i.y,this._roomMaker.initCreate(this._startX,this._startY);var r=Math.floor(this._rollPx/GameConfig.ROOM_GRID_SIZE)-1,n=r+this._wCount,a=Math.floor(this._rollPy/GameConfig.ROOM_GRID_SIZE)-1,o=a+this._hCount;0>r&&(r=0),n>this._maxRollW&&(n=this._maxRollW),0>a&&(a=0),o>this._maxRollH&&(o=this._maxRollH),this.initCreate(r,n,a,o),FogForGrid.getIns().updateFogs()},e.prototype.trySynArea=function(t,e){var i=MapUtil.getRoomPosByPosition(t,e);return i.x!=this._startX||i.y!=this._startY?(this._startX=i.x,this._startY=i.y,void this._roomMaker.synCreate(this._startX,this._startY)):((Math.abs(t-this._rollPx)>GameConfig.ROOM_GRID_SIZE||Math.abs(e-this._rollPy)>GameConfig.ROOM_GRID_SIZE)&&(this._rollPx=t,this._rollPy=e,this.rollOver()),void(1==this._step&&(FogForGrid.getIns().updateFogs(),this._step=-1)))},e.prototype.rollOver=function(){var t=Math.floor(this._rollPx/GameConfig.ROOM_GRID_SIZE)-1,e=t+this._wCount,i=Math.floor(this._rollPy/GameConfig.ROOM_GRID_SIZE)-1,r=i+this._hCount;0>t&&(t=0),e>this._maxRollW&&(e=this._maxRollW),0>i&&(i=0),r>this._maxRollH&&(r=this._maxRollH),this.changeDeleteAndCreate(t,e,i,r),this._step=1},e.prototype.getRoomKey=function(t,e){var i=Math.floor(t/GameConfig.ROOM_GRID_SIZE),r=Math.floor(e/GameConfig.ROOM_GRID_SIZE);return 0>i?i=0:i>this._maxRollW&&(i=this._maxRollW),0>r?r=0:r>this._maxRollH&&(r=this._maxRollH),new egret.Point(i,r)},e.prototype.resetHitTestArray=function(){var t=0,i=e._hitRound.length;for(this._hitTestArray=[],t;i>t;t+=2)this._hitTestArray.push(this._hitTestPoint.x+e._hitRound[t]+"_"+(this._hitTestPoint.y+e._hitRound[t+1]))},e.prototype.initCreate=function(t,e,i,r){var n=t,a=i;for(n;e>=n;n++)for(a=i;r>=a;a++)this.addAreaInit(n,a);this._gridX_from=t,this._gridX_to=e,this._gridY_from=i,this._gridY_to=r,this._roleLink.buildLink("y"),this.sortAllChildren()},e.prototype.changeDeleteAndCreate=function(t,e,i,r){var n=this._gridX_from,a=this._gridY_from;for(n;n<=this._gridX_to;n++)for(a=this._gridY_from;a<=this._gridY_to;a++)(t>n||n>e||i>a||a>r)&&this.delArea(n+"_"+a);for(n=t,a=i,n;e>=n;n++)for(a=i;r>=a;a++)this.preAddArea(n,a);this._gridX_from=t,this._gridX_to=e,this._gridY_from=i,this._gridY_to=r},e.prototype.sortAllChildren=function(){this._roleLink.resetIteration();var t,e=0;do t=this._roleLink.next(),null!=t&&this.addChildAt(t,e++);while(null!=t)},e.prototype.addRoleToLink=function(t,e){void 0===e&&(e=null);var i=this._roleLink.put(t);this.addChildAt(t,i);var r=t;r.setAreaKey(e),r.added(),null!=e&&(null==this._roleGirds.get(e)&&this._roleGirds.set(e,new Array),this._roleGirds.get(e).push(r))},e.prototype.removeRoleFromLink=function(t,e){void 0===e&&(e=!1),this.removeChild(t),this._roleLink.remove(t);var i=t;if(i.removed(),e){var r=i.getAreaKey(),n=this._roleGirds.get(r);if(null!=n){var a=n.indexOf(t);a>=0&&n.splice(a,1)}}},e.prototype.gotoPre=function(t){var e=this.getChildIndex(t);this.swapChildrenAt(e-1,e),this._roleLink.swapNear(t,-1)},e.prototype.gotoNext=function(t){var e=this.getChildIndex(t);this.swapChildrenAt(e,e+1),this._roleLink.swapNear(t,1)},e.prototype.hitTestRole=function(t,e){var i=this.getRoomKey(t,e);(this._hitTestPoint.x!=i.x||this._hitTestPoint.y!=i.y)&&(this._hitTestPoint=i,this.resetHitTestArray());var r,n,a,o,s,h=!1,p=1e5;for(r in this._hitTestArray)if(n=this._roleGirds.get(this._hitTestArray[r]),null!=n)for(r in n)a=n[r],o=a.tryOption(t,e),o>0&&(p>o&&(s=a),!h&&a.hitTestArea(t,e)&&(h=!0));return WorldManager.getIns().setOptionRole(s),h},e._hitRound=[0,0,0,-1,0,1,1,0,-1,0,-1,-1,1,-1,-1,1,1,1],e}(egret.DisplayObjectContainer);__reflect(StageLayer.prototype,"StageLayer");var Tiled_Ground=function(t){function e(){var e=t.call(this)||this;return e.scaleX=WinsManager.scaleX,e.scaleY=WinsManager.scaleY,e}return __extends(e,t),e.getIns=function(){return null==e._ins&&(e._ins=new e),e._ins
},e.prototype.renderUpdate=function(t){this._groud.synPositionTo(this._focus.x,this._focus.y)},e.prototype.getFloorType=function(t,e){return t=Math.floor(t/this.cf_X),e=GameData.mapData.baseMap.$bitmapHeight-Math.floor(e/this.cf_Y),GameData.mapData.getFloorType(t,e)},e.prototype.getFloorTypeByArea=function(t,e){return t=Math.floor(t/this.cf_X),e=Math.floor(e/this.cf_Y),GameData.mapData.getFloorTypeByArea(t,e)},e.prototype.setFocus=function(t){null!=this._focus&&(this._focus.__isFocus=!1),this._focus=this.roleMap.get(t),this._focus.__isFocus=!0},e.prototype.addFocusRole=function(t){this.roleMap.set(t.id,t),this._groud.addRole(t),t.addToWorld()},e.prototype.initWorld=function(t,e){this.roleMap=new Map,this.stageW=App.UIAdapter.StageWidth,this.stageH=App.UIAdapter.StageHeight,this.worldWidth=t,this.worldHeight=e,this.cf_X=this.worldWidth/GameData.mapData.baseMap.$bitmapWidth,this.cf_Y=this.worldHeight/GameData.mapData.baseMap.$bitmapHeight,this._groud=new GroundLayer(this.stageW,this.stageH,this.worldWidth,this.worldHeight),this.addChild(this._groud),this.createSelf(),RenderManager.getIns().registRender(this)},e.prototype.createSelf=function(){this._self=new PlayerRole,this._self.x=GameData.playerData.posX*this.cf_X,this._self.y=GameData.playerData.posY*this.cf_Y,this._groud.initPosition(this._self.x,this._self.y),this.addFocusRole(this._self),this.setFocus(this._self.id),this._self.amendPosition()},e}(egret.DisplayObjectContainer);__reflect(Tiled_Ground.prototype,"Tiled_Ground",["IRender"]);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function n(t){e.call(r,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(r,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GlobalFun=function(){function t(){}return t.wait=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return[2,new Promise(function(i,r){var n=egret.setTimeout(function(){egret.clearTimeout(n),i()},e,t)})]})})},t}();__reflect(GlobalFun.prototype,"GlobalFun");var RoomMaker=function(){function t(){this._id=1,this._counter=new Map,this._plantCounter=new Map,this._plantRandomArea=new Map,this._waitForDelPlants=[],this._focusPlants=[],this._maxWPos=Math.floor(GameConfig.WORD_W/GameConfig.ROOM_CHECK_W),this._maxHPos=Math.floor(GameConfig.WORD_H/GameConfig.ROOM_CHECK_H),this._sgWCount=Math.floor(GameConfig.ROOM_CHECK_W/GameConfig.GRID_W),this._sgHCount=2*Math.floor(GameConfig.ROOM_CHECK_H/GameConfig.GRID_H),GameConfig.map_cfx=GameConfig.WORD_W/GameData.mapData.baseMap.$bitmapWidth,GameConfig.map_cfy=GameConfig.WORD_H/GameData.mapData.baseMap.$bitmapHeight}return t.getIns=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.initCreate=function(e,i){for(var r,n,a,o=[],s=0;s<t._grids.length;s+=2)r=e+t._grids[s],n=i+t._grids[s+1],0>r||0>n||r>=this._maxWPos||n>this._maxHPos||(a=r+"_"+n,GameData.plantData.hasPlantArea(a)?GameData.plantData.loadArea(a):(GameData.plantData.createArea(a),this.createArea(r,n)),o.push(a));this.delArea(o)},t.prototype.synCreate=function(e,i){for(var r,n,a,o=[],s=0;s<t._grids.length;s+=2)r=e+t._grids[s],n=i+t._grids[s+1],0>r||0>n||r>=this._maxWPos||n>this._maxHPos||(a=r+"_"+n,GameData.plantData.hasPlantArea(a)?GameData.plantData.loadArea(a):(GameData.plantData.createArea(a),this.createArea(r,n)),o.push(a));this.delArea(o)},t.prototype.delArea=function(t){var e,i;for(e in t){i=t[e];var r=this._waitForDelPlants.indexOf(i);r>=0&&this._waitForDelPlants.splice(r,1)}for(e in this._focusPlants)i=this._focusPlants[e],t.indexOf(i)<0&&this._waitForDelPlants.indexOf(i)<0&&this._waitForDelPlants.push(i);this._focusPlants=t},t.prototype.createArea=function(t,e){var i,r;for(i in LloydMapData._fixFloorTypes)r=LloydMapData._fixFloorTypes[i],r!=LloydMapData.SEA&&r!=LloydMapData.LAKE&&(this._counter.set(r,0),this._plantRandomArea.set(r,[]));var n,r,a=new Array,o=t*this._sgWCount,s=o+this._sgWCount,h=e*this._sgHCount,p=h+this._sgHCount;for(o;s>o;o++)for(var l=h;p>l;l+=2)if(n=MapUtil.getPosByGrid(o,l),r=GameData.mapData.getFloorTypeByPx(n.x,n.y),!(0>=r)&&r!=LloydMapData.SEA&&r!=LloydMapData.LAKE){var c=this._counter.get(r);c++,this._plantRandomArea.get(r).push(o),this._plantRandomArea.get(r).push(l),1==c?this._plantCounter.set(r,this.getRandomPlantType(r)):c>=this._plantCounter.get(r).count&&(c=0,a.push(this.getPlant(this._plantCounter.get(r),this._plantRandomArea.get(r))),this._plantRandomArea.set(r,[])),this._counter.set(r,c)}GameData.plantData.initArea(t+"_"+e,a),SaveManager.getIns().savePlants(t+"_"+e,JSON.stringify(a))},t.prototype.getPlant=function(t,e){var i=new Object;i.id=this._id++;var r=2*Math.floor(Math.random()*(e.length/2)),n=e[r],a=e[r+1],o=MapUtil.getPosByGrid(n,a);return i.x=Math.floor(o.x-GameConfig.GRID_W/4+Math.random()*GameConfig.GRID_W/2),i.y=Math.floor(o.y-GameConfig.GRID_H/4+Math.random()*GameConfig.GRID_H/2),i.key=Math.floor(o.x/GameConfig.ROOM_GRID_SIZE)+"_"+Math.floor(o.y/GameConfig.ROOM_GRID_SIZE),i},t.prototype.getRandomPlantType=function(t){return JSON.parse('{"count":8}')},t.prototype.renderUpdate=function(t){},t._grids=[0,0,0,-1,0,1,1,0,-1,0,1,-1,1,1,-1,1,-1,-1],t}();__reflect(RoomMaker.prototype,"RoomMaker",["IRender"]);var GlobalObject=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWeb",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),t.prototype.initObject=function(){this.isNative},t.prototype.addGlobalObj=function(t){if(!this.isNative){var e=egret.getQualifiedClassName(t);window[e]=t}},Object.defineProperty(t.prototype,"tempPos",{get:function(){return this._pos||(this._pos=new egret.Point),this._pos},enumerable:!0,configurable:!0}),t}();__reflect(GlobalObject.prototype,"GlobalObject");var ObjectPool=function(){function t(){this._objs=null,this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];App.GlobalObject.addGlobalObj(e);var n=egret.getQualifiedClassName(e);t._content[n]||(t._content[n]=[]);var a=t._content[n];if(a.length)return a.pop();var o,s=egret.getDefinitionByName(n),h=i.length;return 0==h?o=new s:1==h?o=new s(i[0]):2==h?o=new s(i[0],i[1]):3==h?o=new s(i[0],i[1],i[2]):4==h?o=new s(i[0],i[1],i[2],i[3]):5==h&&(o=new s(i[0],i[1],i[2],i[3],i[4])),o.ObjectPoolKey=n,o},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var r,n=t._content[e];if(n.length)for(var a=0;a<n.length;a++)if(n[a].extraKey==i){r=n[a],n.splice(a,1);break}if(!r){var o=egret.getDefinitionByName(e);r=new o(i),r.extraKey=i,r.ObjectPoolKey=e}return r},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey;return t._content[i]?-1!=t._content[i].indexOf(e)?(console.warn("对象池重复添加，检查应用层逻辑。"),!1):(t._content[i].push(e),!0):!1},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var r=t._content[e];r&&r.length;){var n=r.pop();i&&n[i](),n=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var r=t._content[e];if(null!=r){var n=0,a=r.length;for(n;a>n;n++)r[n][i]()}},t._content={},t}();__reflect(ObjectPool.prototype,"ObjectPool");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var DeviceUtils=function(){function t(){this.deviceTypeArr=["iPhone","Android","Windows","Linux","Symbian","Macintosh"],this.windows0s={"Windows NT 6.4":"Windows 10","Windows NT 6.3":"Windows 8.1","Windows NT 6.2":"Windows 8","Windows NT 6.0":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 5.1":"Windows XP"}}return Object.defineProperty(t.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMobile",{get:function(){return egret.MainContext.deviceType==egret.MainContext.DEVICE_MOBILE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsPC",{get:function(){return egret.MainContext.deviceType==egret.MainContext.DEVICE_PC},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsIEBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsChromeBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsSafariBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsOperaBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DeviceOs",{get:function(){var t,e="";return t=this.IsHtml5?navigator.userAgent.toLowerCase():egret.Capabilities.os.toLowerCase(),-1!=t.indexOf("ipod")||-1!=t.indexOf("iphone")||-1!=t.indexOf("ipad")||-1!=t.indexOf("macintosh")||-1!=t.indexOf("ios")?e="ios":-1!=t.indexOf("windows")?e="windows":-1!=t.indexOf("android")?e="android":-1!=t.indexOf("symbian")?e="symbian":-1!=t.indexOf("linux")&&(e="linux"),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAndroid",{get:function(){return"android"==this.DeviceOs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DeviceUA",{get:function(){var t="";return this.IsHtml5&&(t=navigator.userAgent),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DeviceID",{get:function(){var t="";return this.IsNative&&(t=egret.getOption("egret.runtime.egretDeviceId")),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMirco",{get:function(){return""!=egret.getOption("egretTag")||"android_app"==egret.getOption("egret.native.type")},enumerable:!0,configurable:!0}),t.OS_IOS="ios",t.OS_Android="android",t}();__reflect(DeviceUtils.prototype,"DeviceUtils");var DisplayUtility=function(){function t(){}return t.addChild=function(t,e){t&&e&&t.addChild(e)},t.addChildAt=function(t,e,i){t&&e&&t.addChildAt(e,i)},t.removeAllChildren=function(t){for(;t.numChildren;)t.removeChildAt(0)},t.clearChildren=function(e){if(e instanceof egret.DisplayObjectContainer)for(var i=e;i.numChildren>0;){var r=i.removeChildAt(0);t.clearChildren(r)}},t.removeFromParent=function(t){t&&t.parent&&t.parent.removeChild(t)},t.isVisible=function(t){for(;t.visible&&t.parent;)t=t.parent;return t.visible},t.getChildIndex=function(t){var e=void 0;return t&&t.parent&&(e=t.parent.getChildIndex(t)),e},t}();__reflect(DisplayUtility.prototype,"DisplayUtility");var Utils=function(){function t(){}return Object.defineProperty(t,"showLog",{get:function(){return this._showLog},set:function(e){this._showLog=e,log=t.showLog?console.log.bind(console):function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}},enumerable:!0,configurable:!0}),t._showLog=!0,t}();__reflect(Utils.prototype,"Utils");var log=Utils.showLog?console.log.bind(console):function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},GameConfig=function(){function t(){}return t.rocker_bar_sensitivity=120,t.game_time_t_my=1e3,t.GRID_W=200,t.GRID_H=100,t.OFFSET_W=400,t.OFFSET_H=100,t.ROOM_CHECK_W=2e3,t.ROOM_CHECK_H=1e3,t.ROOM_GRID_SIZE=300,t.WORD_W=2e5,t.WORD_H=1e5,t.showFog=!1,t.showRiver=!0,t}();__reflect(GameConfig.prototype,"GameConfig");var GameData=function(){function t(){}return t.historyData=new HistoryData,t.playerData=new PlayerData,t.equipData=new EquipData,t.itemData=new ItemData,t.timeData=new GameTimeData,t.mapData=new LloydMapData,t.plantData=new PlantData,t}();__reflect(GameData.prototype,"GameData");var UIAdapter=function(){function t(t,e){this._preinstallWidth=t,this._preinstallHeight=e}return t.instance=function(e,i){return void 0===e&&(e=1136),void 0===i&&(i=640),this._instance||(this._instance=new t(e,i)),this._instance},Object.defineProperty(t.prototype,"PreinstallWidth",{get:function(){return this._preinstallWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PreinstallHeight",{get:function(){return this._preinstallHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),t.prototype.stageEnable=function(t){this.Stage.touchChildren=t},Object.defineProperty(t.prototype,"StageWidth",{get:function(){return this.Stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"StageHeight",{get:function(){return this.Stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MainShowWidth",{get:function(){return this.StageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MainShowHeight",{get:function(){var t=(this.getWHRatio(),this.StageHeight);return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MainOffsetY",{get:function(){var t=(this.getWHRatio(),0);return t},enumerable:!0,configurable:!0}),t.prototype.adaptiveComponent=function(t,e){t&&(e==AdaptiveType.CenterAdaptive?this.adaptiveScreen(t):e==AdaptiveType.StretchAdaptive?this.bgAdaptiveScreen(t):e==AdaptiveType.MinScaleAdaptive?this.adaptiveMinScale(t):e==AdaptiveType.ScaleXAdaptive?t.scaleX=t.scaleY=this.getScaleX():e==AdaptiveType.ScaleYAdaptive&&(t.scaleX=t.scaleY=this.getScaleY()))},t.prototype.adaptiveScreen=function(t){t&&(t.x=this.StageWidth/2,t.y=this.StageHeight/2,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,this.adaptiveMinScale(t))},t.prototype.bgAdaptiveScreen=function(t){t&&(t.width=this.StageWidth,t.height=this.StageHeight)},t.prototype.adaptiveMinScale=function(t){t&&(t.scaleX=t.scaleY=this.getMinScale())},t.prototype.getScaleX=function(){return this.MainShowWidth/this.PreinstallWidth},t.prototype.getScaleY=function(){return this.MainShowHeight/this.PreinstallHeight},t.prototype.getMinScale=function(){return Math.min(this.getScaleX(),this.getScaleY(),1)},t.prototype.getWHRatio=function(t){void 0===t&&(t=2);var e=this.StageWidth/this.StageHeight,i=Math.pow(10,t);return e=~~(e*i)/i},Object.defineProperty(t.prototype,"ratioValue",{get:function(){return window.innerWidth/this.StageWidth},enumerable:!0,configurable:!0}),t}();__reflect(UIAdapter.prototype,"UIAdapter");var AdaptiveType;!function(t){t[t.CenterAdaptive=1]="CenterAdaptive",t[t.StretchAdaptive=2]="StretchAdaptive",t[t.MinScaleAdaptive=3]="MinScaleAdaptive",t[t.ScaleXAdaptive=4]="ScaleXAdaptive",t[t.ScaleYAdaptive=5]="ScaleYAdaptive"}(AdaptiveType||(AdaptiveType={}));var EventConst=function(){function t(){}return t.Event_start="start",t}();__reflect(EventConst.prototype,"EventConst");var Observer=function(){function t(){this.dict=null,this.type=0,this.dict={},this.eVec=new Array}return Object.defineProperty(t,"instance",{get:function(){return t._instance?t._instance:t._instance=new t},enumerable:!0,configurable:!0}),t.prototype.addListener=function(t,e,i){var r=this.dict[t];null==r&&(r=new Array,this.dict[t]=r);var n=0,a=r.length;for(n;a>n;n++)if(r[n][0]==e&&r[n][1]==i)return;r.push([e,i])},t.prototype.removeListener=function(t,e,i){var r=this.dict[t];if(null!=r){var n=0,a=r.length;for(n;a>n;n++)if(r[n][0]==e&&r[n][1]==i){r.splice(n,1);break}0==r.length&&(this.dict[t]=null,delete this.dict[t])}},t.prototype.removeAll=function(t){for(var e=Object.keys(this.dict),i=0,r=e.length;r>i;i++){for(var n=e[i],a=this.dict[n],o=0;o<a.length;o++)a[o][1]==t&&(a.splice(o,1),o--);0==a.length&&(this.dict[n]=null,delete this.dict[n])}},t.prototype.dispatch=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null!=this.dict[t]){var r=new MessageVo;r.type=t,r.param=e,0==this.type?this.eVec.push(r):1==this.type?this.dealMsg(r):console.log("Observer未实现的类型")}},t.prototype.dealMsg=function(t){for(var e=this.dict[t.type],i=0,r=e.length,n=null;r>i;)n=e[i],n[0].apply(n[1],t.param),e.length!=r&&(r=e.length,i--),i++;t.dispose(),t=null},t._instance=null,t}();__reflect(Observer.prototype,"Observer");var MessageVo=function(){function t(){this.type=null,this.param=null}return t.prototype.dispose=function(){this.type=null,this.param=null},t}();__reflect(MessageVo.prototype,"MessageVo");var GameController=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.startGame=function(t,e){this.gameUI||(this.gameUI=new GameUI,e.addChild(this.gameUI))},t}();__reflect(GameController.prototype,"GameController");var GameLoading=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},Object.defineProperty(e,"instance",{get:function(){return e._instance?e._instance:e._instance=new e},enumerable:!0,configurable:!0}),e.prototype.show=function(){log("show"),DisplayUtility.addChild(App.LayerManager.GUIDE_LAYER,this)},e.prototype.hide=function(){log("hide"),DisplayUtility.removeFromParent(this)},e._instance=null,e}(BaseComponent);__reflect(GameLoading.prototype,"GameLoading");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var LayerManager=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.initLayer=function(t){this.container=t,this.gameSceneLayer=new egret.DisplayObjectContainer,this.gameSceneLayer.name="gameSceneLayer",this.gameUILayer=new egret.DisplayObjectContainer,this.gameUILayer.name="gameUILayer",this.panelLayer=new egret.DisplayObjectContainer,this.panelLayer.name="panelLayer",this.tipsLayer=new egret.DisplayObjectContainer,this.tipsLayer.name="tipsLayer",this.guideLayer=new egret.DisplayObjectContainer,this.guideLayer.name="guideLayer",this.effectLayer=new egret.DisplayObjectContainer,this.effectLayer.name="effectLayer",this.container.addChild(this.gameSceneLayer),this.container.addChild(this.gameUILayer),this.container.addChild(this.panelLayer),this.container.addChild(this.tipsLayer),this.container.addChild(this.guideLayer),this.container.addChild(this.effectLayer)},Object.defineProperty(t.prototype,"GAME_SCENE_LAYER",{get:function(){return this.gameSceneLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"GAME_UI_LAYER",{get:function(){return this.gameUILayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PANEL_LAYER",{get:function(){return this.panelLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TIPS_LAYER",{get:function(){return this.tipsLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"GUIDE_LAYER",{get:function(){return this.guideLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EFFECT_LAYER",{get:function(){return this.effectLayer},enumerable:!0,configurable:!0}),t.prototype.addChildToLayer=function(t,e){return t&&e?void t.addChild(e):void console.warn("显示容器不存在")},t.prototype.addChildAtToLayer=function(t,e,i){return!t||e?void console.warn("显示容器不存在"):void t.addChildAt(e,i)},t.prototype.removeChildToLayer=function(t,e){return t&&e?void(e.parent&&t.removeChild(e)):void console.warn("显示容器不存在")},t}();__reflect(LayerManager.prototype,"LayerManager");var Area2D=function(){function t(){this.id=0,this.isOutside=!1,this.isWater=!1,this.neighbor=new Array,this.vertex=new Array,this.humidity=1}return t.prototype.getElevation=function(){return this.vertex[0].elevation},t}();__reflect(Area2D.prototype,"Area2D");var AreaPoint=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=t.call(this,e,i)||this;return r.id=0,r.nears=[],r.areas=[],r.elevation=10,r.sorted=!1,r.river=0,r}return __extends(e,t),e.findDownstream=function(t,e){t.sorted||(t.sorted=!0,t.nears.sort(function(t,e){return t.elevation>e.elevation?1:t.elevation==e.elevation?0:-1}));for(var i=0;i<t.nears.length;i++)if(e.downsteams.indexOf(t.nears[i])<0)return t.nears[i];return null},e}(egret.Point);__reflect(AreaPoint.prototype,"AreaPoint");var Lake=function(){function t(){this._areas=new Array,t.ccId++,this.id=t.ccId}return t.prototype.addArea=function(t){this._areas.indexOf(t)<0&&this._areas.push(t)},t.prototype.getAreas=function(){return this._areas},t.prototype.checkSefl=function(){LogTrace.log("LakeID="+this.id+" AreaCount="+this._areas.length)},t.ccId=0,t}();__reflect(Lake.prototype,"Lake");var River=function(){function t(){this.downsteams=new Array}return t}();__reflect(River.prototype,"River");var PlantLO=function(){function t(){}return t}();__reflect(PlantLO.prototype,"PlantLO");var UserLO=function(){function t(){}return t}();__reflect(UserLO.prototype,"UserLO");var EquipType=function(){function t(){}return t.weapon=1,t.weapon_1=1,t.weapon_2=2,t.weapon_3=3,t.weapon_4=4,t.weapon_5=5,t.weapon_6=6,t.weapon_7=7,t.weapon_8=8,t.clothes=2,t.trousers=3,t.hat=4,t.shield=5,t.leg=6,t.glove=7,t.shoe=8,t.ring=9,t.necklace=10,t.arrow=11,t.pow=12,t.pow_1=1,t.pow_2=2,t.pow_3=3,t.weight_1="light",t.weight_2="medium",t.weight_4="heavy",t}();__reflect(EquipType.prototype,"EquipType");var ItemType=function(){function t(){}return t.material=1,t.book=2,t.task=3,t.rubbish=4,t.mdc=5,t}();__reflect(ItemType.prototype,"ItemType");var UpdateType=function(){function t(){}return t.USER_HISTORY_BACLL=10001,t.MAP_SELF_MOVE=20001,t.MAP_OPT_CHANGE=20002,t.MAIN_LOADING_SET=9990001,t}();__reflect(UpdateType.prototype,"UpdateType");var WorWindowType=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.MENU_WINDOW="MENU_WINDOW",e.ROCKER_LEFT="ROCKER_LEFT",e.TOP_TOOLBAR="TOP_TOOLBAR",e.BOTTOM_TOOLBAR="BOTTOM_TOOLBAR",e.LOG_WINDOW="LOG_WINDOW",e.MINI_MAP="MINI_MAP",e.OPT_MAP="OPT_MAP",e.CURB_BAR="CURB_BAR",e.ROLE_WINDOW="ROLE_WINDOW",e.MAIN_LOADING="MAIN_LOADING",e}(WindowType);__reflect(WorWindowType.prototype,"WorWindowType");var EquipVO=function(){function t(){}return t}();__reflect(EquipVO.prototype,"EquipVO");var ItemVO=function(){function t(){}return t}();__reflect(ItemVO.prototype,"ItemVO");var GameManager=function(){function t(){this.isNewGame=!1}return t.getIns=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.startNewGame=function(){this.buildEnter()},t.prototype.buildEnter=function(){WorldMakerManager.getIns().createWorld(),ProxyManager.getIns().send(ModuleType.USER,ProxyType.USER_CREATE,'{"posX":'+GameData.playerData.posX+',"posY":'+GameData.playerData.posY+"}")},t.prototype.createEnter=function(){if(!this.isNewGame){var t=localStorage.getItem(Server_Map.T_MAP_BASE);WorldMakerManager.getIns().rebuildWord(t),LogTrace.log("loadBaseMap.len="+t.length)}ProxyManager.getIns().send(ModuleType.USER,ProxyType.USER_ENTERGAME)},t.prototype.startOldGame=function(){var t=this;GameLoading.instance.show(),GlobalFun.wait(100).then(function(){t.createEnter()})},t.prototype.enterGame=function(){App.LayerManager.addChildToLayer(App.LayerManager.GAME_SCENE_LAYER,Tiled_Ground.getIns()),GameData.plantData.loadConfig(),Tiled_Ground.getIns().initWorld(GameConfig.WORD_W,GameConfig.WORD_H),GameData.timeData.play(),WinsManager.getIns().gameStage().addEventListener(egret.Event.DEACTIVATE,this.deactivateHandler,this),WinsManager.getIns().gameStage().addEventListener(egret.Event.ACTIVATE,this.activateHandler,this),GameLoading.instance.hide(),RenderManager.getIns().startRender()},t.prototype.deactivateHandler=function(){SaveManager.getIns().saveAll(),LogTrace.log("暂停游戏->存档")},t.prototype.activateHandler=function(){LogTrace.log("继续游戏->继续")},t.prototype.openGameUI=function(t){WinsManager.getIns().openWindow(t)},t.prototype.setMainLoadingInfo=function(t){WinsManager.getIns().updateWin(UpdateType.MAIN_LOADING_SET,[WorWindowType.MAIN_LOADING],t)},t}();__reflect(GameManager.prototype,"GameManager");var SaveManager=function(){function t(){}return t.getIns=function(){return t._ins||(t._ins=new t),t._ins},t.prototype.saveAll=function(){this.savePlayer(),this.saveFocusPlants(),FogForGrid.getIns().saveMiniMap()},t.prototype.savePlayer=function(){GameData.playerData.posX=PlayerRole.self.x/Tiled_Ground.getIns().cf_X,GameData.playerData.posY=PlayerRole.self.y/Tiled_Ground.getIns().cf_Y,localStorage.setItem(Server_User.T_USER_DATA,JSON.stringify(GameData.playerData))},t.prototype.saveFocusPlants=function(){},t.prototype.savePlants=function(t,e){localStorage.setItem(Server_Map.T_MAP_PLANTS+t,e)},t}();__reflect(SaveManager.prototype,"SaveManager");var WorldMakerManager=function(){function t(){this._sizeW=800,this._sizeH=800}return t.getIns=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.createWorld=function(){GameManager.getIns().setMainLoadingInfo(LanguageData.getIns().getLang(10001));var t=RandomPointUtil.getRandomPoints(this._sizeW,this._sizeH,10,1e3),e=new LloydUtil(t,this._sizeW,this._sizeH);e.delaunay(),e.voronoi(),e.optimization(),e.optimization(),e.optimization(),e.optimization(),e.optimization();var i=PerlinNoiseUtil.noise2D(500,500);GameData.mapData.initData(e.getPolgons(),this._sizeW,this._sizeH),GameData.mapData.adjustCoast(.58,i),GameData.mapData.initArea(),GameData.mapData.checkTerrain(),GameData.mapData.amendLake(6,8),GameData.mapData.initAltitude(5,8,2),GameData.mapData.initRiver(1,1,5,8,10),GameData.mapData.initHumidity(),GameData.mapData.buildLand(),GameData.mapData.amendOasis(3);var r=GameData.mapData.getBorn();GameData.playerData.posX=r.x,GameData.playerData.posY=r.y;var n=JSON.stringify(GameData.mapData.getDb());localStorage.setItem(Server_Map.T_MAP_BASE,n),GameData.plantData.resetConfig(),this.drawTr(),FogForGrid.getIns().init(this._sizeW,this._sizeH)},t.prototype.drawTr=function(t){void 0===t&&(t=!1);var e=GameData.mapData.getMapBaseTextture(800,800),i=new egret.RenderTexture;i.drawToTexture(e),GameData.mapData.baseMap=i;var r=GameData.mapData.getRiverTextture(800,800);i=new egret.RenderTexture,i.drawToTexture(r),GameData.mapData.riverMap=i,t&&(WinsManager.getIns().gameStage().addChild(e),GameConfig.showRiver&&WinsManager.getIns().gameStage().addChild(r))},t.prototype.rebuildWord=function(t){GameData.mapData.build(JSON.parse(t)),this.drawTr(),FogForGrid.getIns().rebuild(this._sizeW,this._sizeH)},t.prototype.renderUpdate=function(t){},t}();__reflect(WorldMakerManager.prototype,"WorldMakerManager",["IRender"]);var WorldManager=function(){function t(){this.focusOptionRole=null}return t.getIns=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.setOptionRole=function(t){t!=this.focusOptionRole&&(this.focusOptionRole=t,WinsManager.getIns().updateWin(UpdateType.MAP_OPT_CHANGE,[WorWindowType.CURB_BAR]))},t.prototype.actOptionRole=function(){if(null!=this.focusOptionRole)switch(this.focusOptionRole.getOptType()){case RoleType.PLANT_TREE:break;case RoleType.PLANT_COLL:break;case RoleType.GROUND_ITEM:break;case RoleType.ROLE_NPC:break;case RoleType.ROLE_ANIMAL:break;case RoleType.ROLE_WILD:break;case RoleType.ORE:break;case RoleType.TRAP:}},t}();__reflect(WorldManager.prototype,"WorldManager");var TiledFloorBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getType=function(){return this.fType},e.prototype.removeFloor=function(){return this.parent.removeChild(this),this},e.prototype.standOn=function(){this.alpha=.5},e.prototype.setPosition=function(t,i){this.posx=t,this.posy=i,i%2==0?(this.x=t*e.GW-e.GW/2,this.y=i/2*e.GH-e.GH/2):(this.x=t*e.GW,this.y=(i-1)/2*e.GH)},e.prototype.createFloor=function(t,i,r){this.setPosition(i,r),this.fType=Tiled_Ground.getIns().getFloorType(this.x+e.GW_HALF,this.y+e.GH_HALF);var n=new egret.Texture,a=e.getBitmapData(this.fType);a&&(e.lastBitMap=a),n.bitmapData=e.lastBitMap,this.texture=n,t.addChild(this)},e.prototype.reCreate=function(t){this.fType=t,this.$bitmapData=e.getBitmapData(this.fType)},e.getBitmapData=function(t){if(0>t)return null;if(null==this._floorDic.get(t)){var e=new egret.RenderTexture,i=new egret.Shape;i.graphics.beginFill(t),i.graphics.lineStyle(1,t,1),i.graphics.moveTo(GameConfig.GRID_W/2,0),i.graphics.lineTo(GameConfig.GRID_W,GameConfig.GRID_H/2),i.graphics.lineTo(GameConfig.GRID_W/2,GameConfig.GRID_W/2),i.graphics.lineTo(0,GameConfig.GRID_H/2),i.graphics.lineTo(GameConfig.GRID_W/2,0),i.graphics.endFill(),e.drawToTexture(i),this._floorDic.set(t,e.bitmapData)}return this._floorDic.get(t)},e._floorDic=new Map,e}(egret.Bitmap);__reflect(TiledFloorBase.prototype,"TiledFloorBase",["IFloor"]);var Plant=function(t){function e(){var e=t.call(this)||this,i=new egret.Shape;return i.graphics.beginFill(0,1),i.graphics.drawRect(-20,-250,40,250),i.graphics.beginFill(65280,1),i.graphics.drawRect(-70,-250,140,80),i.graphics.endFill(),e.addChild(i),e._rectX=-20,e._rectY=-30,e._rectW=40,e._rectH=30,e}return __extends(e,t),e.prototype.tryOption=function(t,i){return t>=this._gx-e._optRound&&t<=this._gx+this._rectW+e._optRound&&i>=this._gy-e._optRound&&i<=this._gy+this._rectH+e._optRound?Math.abs(Math.min(t-(this._gx-e._optRound),this._gx+this._rectW+e._optRound-t)):-1},e.prototype.hitTestArea=function(t,e){return t>=this._gx&&t<=this._gx+this._rectW&&e>=this._gy&&e<=this._gy+this._rectH},e.prototype.setData=function(t){this._data=t},e.prototype.getData=function(){return this._data},e.prototype.getPre=function(){return this._preLink},e.prototype.setPre=function(t){this._preLink=t
},e.prototype.getNext=function(){return this._nextLink},e.prototype.setNext=function(t){this._nextLink=t},e.prototype.setAreaKey=function(t){this._ak=t},e.prototype.getAreaKey=function(){return this._ak},e.prototype.removed=function(){},e.prototype.added=function(){this._gx=this.x+this._rectX,this._gy=this.y+this._rectY},e.prototype.getOptType=function(){return RoleType.POLE_PLANT},e._optRound=20,e}(egret.DisplayObjectContainer);__reflect(Plant.prototype,"Plant",["ILink","IRole"]);var PlantMaker=function(){function t(){}return t.getPlant=function(t){var e=new Plant;return e.setData(t),e.x=t.x,e.y=t.y,e},t}();__reflect(PlantMaker.prototype,"PlantMaker");var PlayerRole=function(t){function e(){var i=t.call(this)||this;e.self=i,i.type=RoleType.ROLE_PLAYER;var r=new egret.Shape;return r.graphics.beginFill(16711680,1),r.graphics.drawRect(-30,-120,60,120),r.graphics.endFill(),i.addChild(r),i.speedX=16,i.speedY=14,i}return __extends(e,t),e.prototype.renderUpdate=function(t){if(0!=RockBarContorller.offset){var e=this.x+RockBarContorller.multX*this.speedX,i=this.y+RockBarContorller.multY*this.speedY,r=FloorLayer.floorSelf.getStandType(e,i),n=!1;r==StandType.LAND&&(StageLayer.self.hitTestRole(e,i)?(e=this.x,i=this.y+RockBarContorller.multY*this.speedY,StageLayer.self.hitTestRole(e,i)?(e=this.x+RockBarContorller.multX*this.speedX,i=this.y,StageLayer.self.hitTestRole(e,i)||(n=!0)):n=!0):n=!0,n&&(this.x=e,this.y=i,this.checkPosY(),WinsManager.getIns().updateWin(UpdateType.MAP_SELF_MOVE,[WorWindowType.MINI_MAP])))}},e.prototype.amendPosition=function(){for(;StageLayer.self.hitTestRole(this.x,this.y);)this.y+=20},e}(FocusRole);__reflect(PlayerRole.prototype,"PlayerRole");var ModuleType=function(){function t(){}return t.USER=1,t}();__reflect(ModuleType.prototype,"ModuleType");var ProxyManager=function(){function t(){ServerVirtual.build(),this._moduleMap=new Map,this._moduleMap.set(ModuleType.USER,new UserModule(ModuleType.USER))}return t.getIns=function(){return this._ins||(this._ins=new t),this._ins},t.prototype.send=function(t,e,i){void 0===i&&(i=""),this._moduleMap.get(t).requestToServer(e,i)},t.prototype.response=function(t,e,i){void 0===i&&(i=""),this._moduleMap.get(t).responseFromServer(e,i)},t}();__reflect(ProxyManager.prototype,"ProxyManager");var ProxyType=function(){function t(){}return t.USER_GETHISTORY=1001,t.USER_ENTERGAME=1002,t.USER_CREATE=1003,t}();__reflect(ProxyType.prototype,"ProxyType");var App=function(){function t(){}return Object.defineProperty(t,"Observer",{get:function(){return Observer.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UIAdapter",{get:function(){return UIAdapter.instance()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"GlobalObject",{get:function(){return GlobalObject.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"GameController",{get:function(){return GameController.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LayerManager",{get:function(){return LayerManager.instance},enumerable:!0,configurable:!0}),t}();__reflect(App.prototype,"App");var UserModule=function(t){function e(e){var i=t.call(this,e)||this;return i.registHandler(ProxyType.USER_GETHISTORY,i.userHistoryHandler),i.registHandler(ProxyType.USER_ENTERGAME,i.userEnterGame),i.registHandler(ProxyType.USER_CREATE,i.createUser),i}return __extends(e,t),e.prototype.userHistoryHandler=function(t,i){if(t==e.TYPE_RQ)return i;var r=JSON.parse(i);return GameData.historyData.initHistoryData(r),WinsManager.getIns().updateWin(UpdateType.USER_HISTORY_BACLL,[WorWindowType.MENU_WINDOW],null),null},e.prototype.userEnterGame=function(t,i){if(t==e.TYPE_RQ)return i;var r=JSON.parse(i);return ObjectUtil.copyTo(r,GameData.playerData),GameManager.getIns().enterGame(),null},e.prototype.createUser=function(t,i){return t==e.TYPE_RQ?i:(LogTrace.log("create new player completed!!"),GameManager.getIns().startOldGame(),null)},e}(ModuleBase);__reflect(UserModule.prototype,"UserModule");var Server_Map=function(){function t(){}return t.T_MAP_BASE="T_MAP_BASE",t.T_MAP_PLANTS="T_MAP_PLANTS",t.T_MAP_MINI="T_MAP_MINI",t}();__reflect(Server_Map.prototype,"Server_Map");var Server_User=function(){function t(){ServerVirtual.registHandlerTest(ModuleType.USER,ProxyType.USER_GETHISTORY,this.getUserHistory,this),ServerVirtual.registHandlerTest(ModuleType.USER,ProxyType.USER_ENTERGAME,this.userEnterGame,this),ServerVirtual.registHandlerTest(ModuleType.USER,ProxyType.USER_CREATE,this.userCreate,this)}return t.prototype.getUserHistory=function(e){var i=localStorage.getItem(t.T_USER_HISTORY);return i&&""!=i?i:'{"has":0}'},t.prototype.userEnterGame=function(e){var i=localStorage.getItem(t.T_USER_DATA);return i},t.prototype.userCreate=function(e){var i=JSON.parse(e),r=LocalData.getObjectByKv("UserLO",{id:1}),n=new Object;return ObjectUtil.copyTo(r,n),n.posX=i.posX,n.posY=i.posY,localStorage.setItem(t.T_USER_DATA,JSON.stringify(n)),GameData.historyData.has=1,localStorage.setItem(t.T_USER_HISTORY,JSON.stringify(GameData.historyData)),null},t.T_USER_HISTORY="T_USER_HISTORY",t.T_USER_DATA="T_USER_DATA",t}();__reflect(Server_User.prototype,"Server_User");var ServerVirtual=function(){function t(){}return t.build=function(){t._handlerMap=new Map,t._thisObjectMap=new Map,new Server_User},t.registHandlerTest=function(e,i,r,n){t._handlerMap.set(e+"_"+i,r),t._thisObjectMap.set(e,n)},t.request=function(e,i,r){var n=t._handlerMap.get(e+"_"+i).apply(t._thisObjectMap.get(e),[r]);ProxyManager.getIns().response(e,i,n)},t}();__reflect(ServerVirtual.prototype,"ServerVirtual");var TiledWorld=function(){function t(){}return t}();__reflect(TiledWorld.prototype,"TiledWorld");var RockerBar=function(t){function e(){var e=t.call(this)||this;return e._movePoint=new egret.Point,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._px=this.x,this._py=this.y,this._restPoint=new egret.Point(this.barBtn.x,this.barBtn.y),this.barBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this)},e.prototype.touchBeginHandler=function(t){null==this._startPoint&&(this._startPoint=new egret.Point),this._startPoint.x=t.stageX,this._startPoint.y=t.stageY,this.barBtn.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),this.barBtn.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),this.barBtn.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this)},e.prototype.touchMoveHandler=function(t){this._movePoint.x=t.stageX,this._movePoint.y=t.stageY;var e=egret.Point.distance(this._startPoint,this._movePoint);if(e<=GameConfig.rocker_bar_sensitivity)this.barBtn.x=this._restPoint.x+this._movePoint.x-this._startPoint.x,this.barBtn.y=this._restPoint.y+this._movePoint.y-this._startPoint.y;else{var i=egret.Point.interpolate(this._movePoint,this._startPoint,GameConfig.rocker_bar_sensitivity/e);this.barBtn.x=i.x-this._px,this.barBtn.y=i.y-this._py}RockBarContorller.multX=(this._movePoint.x-this._startPoint.x)/e,RockBarContorller.multY=(this._movePoint.y-this._startPoint.y)/e,RockBarContorller.offset=e/GameConfig.rocker_bar_sensitivity},e.prototype.cancelHandler=function(t){this.barBtn.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),this.barBtn.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),this.barBtn.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this),egret.Tween.removeTweens(this.barBtn),egret.Tween.get(this.barBtn).to({x:this._restPoint.x,y:this._restPoint.y},50,egret.Ease.backOut),RockBarContorller.multX=0,RockBarContorller.multY=0,RockBarContorller.offset=0},e}(eui.Component);__reflect(RockerBar.prototype,"RockerBar",["eui.UIComponent","egret.DisplayObject"]);var BottomBar=function(t){function e(){var e=t.call(this)||this;return e.typeName=WorWindowType.BOTTOM_TOOLBAR,e.layerType=LayerType.LAYER_MENU,e.align(AlignType.BOTTOM_CENTER,0,0),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(GameWindow);__reflect(BottomBar.prototype,"BottomBar",["eui.UIComponent","egret.DisplayObject"]);var CurbBar=function(t){function e(){var e=t.call(this)||this;return e.scaleX=e.scaleY=WinsManager.scaleX,e.typeName=WorWindowType.CURB_BAR,e.layerType=LayerType.LAYER_MENU,e.align(AlignType.BOTTOM_RIGHT,0,0),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._optBtn=this.getChildByName("optBtn"),this.addEventTap("optBtn"),this.initOptTarget()},e.prototype.initOptTarget=function(){this._optBtn.visible=null!=WorldManager.getIns().focusOptionRole},e.prototype.tapCallback=function(t){switch(t){case"optBtn":}},e.prototype.update=function(t,e){switch(t){case UpdateType.MAP_OPT_CHANGE:this.initOptTarget()}},e}(GameWindow);__reflect(CurbBar.prototype,"CurbBar",["eui.UIComponent","egret.DisplayObject"]);var GameMainLoaderWindow=function(t){function e(){var e=t.call(this)||this;return e.layerType=LayerType.LAYER_POP,e.typeName=WorWindowType.MAIN_LOADING,e.align(AlignType.TOP_LEFT),e}return __extends(e,t),e.prototype.childrenCreated=function(){this._bgShape=new egret.Shape,this._bgShape.graphics.beginFill(0,1),this._bgShape.graphics.drawRect(0,0,1,1),this._bgShape.graphics.endFill(),this.addChildAt(this._bgShape,0),this._infoLabel=this.getChildByName("message"),this._infoLabel.text="",t.prototype.childrenCreated.call(this)},e.prototype.resize=function(){t.prototype.resize.call(this),null!=this._bgShape&&(this._bgShape.scaleX=WinsManager.stageWidth,this._bgShape.scaleY=WinsManager.stageHeight,this._infoLabel.x=(WinsManager.stageWidth-this._infoLabel.width)/2,this._infoLabel.y=(WinsManager.stageHeight-this._infoLabel.height)/2)},e.prototype.update=function(t,e){switch(t){case UpdateType.MAIN_LOADING_SET:this._infoLabel.text=e}},e}(GameWindow);__reflect(GameMainLoaderWindow.prototype,"GameMainLoaderWindow",["eui.UIComponent","egret.DisplayObject"]);var LogWindow=function(t){function e(){var e=t.call(this)||this;return e.layerType=LayerType.LAYER_UI,e.typeName=WorWindowType.LOG_WINDOW,e.pop=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(GameWindow);__reflect(LogWindow.prototype,"LogWindow",["eui.UIComponent","egret.DisplayObject"]);var MenuWindow=function(t){function e(){var e=t.call(this)||this;return e.typeName=WorWindowType.MENU_WINDOW,e.layerType=LayerType.LAYER_UI,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.newGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.optionHandler,this),this.oldGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.optionHandler,this),this.reOpen()},e.prototype.reOpen=function(){this.newGame.visible=!1,this.oldGame.visible=!1,ProxyManager.getIns().send(ModuleType.USER,ProxyType.USER_GETHISTORY)},e.prototype.update=function(t,e){switch(t){case UpdateType.USER_HISTORY_BACLL:this.updatePanel()}},e.prototype.updatePanel=function(){this.newGame.visible=!0,this.oldGame.visible=GameData.historyData.hasData},e.prototype.optionHandler=function(t){switch(t.currentTarget.name){case"newGame":GameData.historyData.hasData?AlertWindow.alertShow("确定要开始新的冒险吗?这将覆盖原有存档!",this.startNewGame,this):this.startNewGame(!0);break;case"oldGame":this.startOldGame()}},e.prototype.startNewGame=function(t){t&&(LogTrace.log("startGame for new!"),GameManager.getIns().isNewGame=!0,GameManager.getIns().startNewGame())},e.prototype.startOldGame=function(){LogTrace.log("startGame for old"),GameManager.getIns().isNewGame=!1,GameManager.getIns().startOldGame()},e}(GameWindow);__reflect(MenuWindow.prototype,"MenuWindow",["eui.UIComponent","egret.DisplayObject"]);var MiniMap=function(t){function e(){var e=t.call(this)||this;return e.typeName=WorWindowType.MINI_MAP,e.layerType=LayerType.LAYER_GROUND,e.align(AlignType.CENTER,0,0),e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){this.initPanel(),t.prototype.childrenCreated.call(this)},e.prototype.initPanel=function(){var t=Math.floor(.7*WinsManager.getIns().gameStage().stageWidth),e=Math.floor(.7*WinsManager.getIns().gameStage().stageHeight);this._mapBg=new egret.Bitmap;var i=new egret.Texture;if(i.bitmapData=GameData.mapData.baseMap.bitmapData,this._mapBg.texture=i,this._scX=t/this._mapBg.width,this._scY=e/this._mapBg.height,this._mapBg.scaleX=this._scX,this._mapBg.scaleY=this._scY,this.addChild(this._mapBg),GameConfig.showRiver){this._riverBg=new egret.Bitmap;var r=new egret.Texture;r.bitmapData=GameData.mapData.riverMap.bitmapData,this._riverBg.texture=r,this._riverBg.scaleX=this._scX,this._riverBg.scaleY=this._scY,this.addChild(this._riverBg)}this.width=t,this.height=e,this._self=new egret.Shape,this._self.graphics.beginFill(16711680,1),this._self.graphics.drawCircle(0,0,5),this._self.graphics.endFill(),this.addChild(this._self),FogForGrid.getIns().scaleX=this._scX,FogForGrid.getIns().scaleY=this._scY,GameConfig.showFog&&this.addChild(FogForGrid.getIns()),this.updateSelfPosition(),this.synFog()},e.prototype.synFog=function(){FogForGrid.getIns().reDraw(),FogForGrid.getIns().autoDraw=!0},e.prototype.reOpen=function(){t.prototype.reOpen.call(this),this.updateSelfPosition(),this.synFog()},e.prototype.beforeClose=function(){return FogForGrid.getIns().autoDraw=!1,t.prototype.beforeClose.call(this)},e.prototype.update=function(t,e){switch(t){case UpdateType.MAP_SELF_MOVE:this.updateSelfPosition()}},e.prototype.updateSelfPosition=function(){this._self&&(this._self.x=PlayerRole.self.x/GameConfig.map_cfx*this._scX,this._self.y=PlayerRole.self.y/GameConfig.map_cfy*this._scY)},e}(GameWindow);__reflect(MiniMap.prototype,"MiniMap",["eui.UIComponent","egret.DisplayObject"]);var OptWindow=function(t){function e(){var e=t.call(this)||this;return e.typeName=WorWindowType.OPT_MAP,e.layerType=LayerType.LAYER_UI,e.align(AlignType.CENTER,0,0),e.pop=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(GameWindow);__reflect(OptWindow.prototype,"OptWindow",["eui.UIComponent","egret.DisplayObject"]);var RoleWindow=function(t){function e(){var e=t.call(this)||this;return e.typeName=WorWindowType.ROLE_WINDOW,e.layerType=LayerType.LAYER_MENU,e.align(AlignType.TOP_LEFT,0,0),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._timeLabel=this.getChildByName("timeTxt"),this._day=this.getChildByName("day"),this._dayBg=this.getChildByName("dayBg"),this._light=this.getChildByName("light"),this._lightBg=this.getChildByName("lightBg"),this._hpBar=new ProgressBar(this.getChildByName("hpBar")),this._mpBar=new ProgressBar(this.getChildByName("mpBar")),this._epBar=new ProgressBar(this.getChildByName("epBar")),this.flushTime(),this.flushBars(),DelayCall.call(1e3,this.flushTime,this,null,0)},e.prototype.flushTime=function(){this._timeLabel.text=GameData.timeData.pd+" "+TimeUtil.getTimeStrByHM(GameData.timeData.hour,GameData.timeData.min),this._dayBg.visible=this._day.visible=!GameData.timeData.isLight,this._light.visible=this._lightBg.visible=GameData.timeData.isLight},e.prototype.flushBars=function(){},e}(GameWindow);__reflect(RoleWindow.prototype,"RoleWindow",["eui.UIComponent","egret.DisplayObject"]);var TopToolBar=function(t){function e(){var e=t.call(this)||this;return e._btnNames=["logBtn","mapBtn","optBtn"],e.typeName=WorWindowType.TOP_TOOLBAR,e.layerType=LayerType.LAYER_MENU,e.align(AlignType.TOP_RIGHT,0,20),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventTap(this._btnNames)},e.prototype.tapCallback=function(t){switch(t){case"logBtn":GameManager.getIns().openGameUI(LogWindow);break;case"mapBtn":WinsManager.getIns().switchWin(MiniMap);break;case"optBtn":GameManager.getIns().openGameUI(OptWindow);break;default:LogTrace.log("未处理的子对象")}},e}(GameWindow);__reflect(TopToolBar.prototype,"TopToolBar",["eui.UIComponent","egret.DisplayObject"]);